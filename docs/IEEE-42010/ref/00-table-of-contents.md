# Table of Contents

- [Architecture Overview](#architecture-overview)
  - [Quick Links](#quick-links)
  - [Introduction](#introduction)
  - [Executive Summary](#executive-summary)
    - [Key Highlights](#key-highlights)
    - [Document Organization](#document-organization)
    - [Target Audience](#target-audience)
  - [Enterprise MCP Architecture Layers](#enterprise-mcp-architecture-layers)
    - [Layer Descriptions](#layer-descriptions)
    - [When to Use Each Layer](#when-to-use-each-layer)
  - [Request Flow Pattern](#request-flow-pattern)
    - [Flow Steps](#flow-steps)
  - [FastMCP Integration Pattern](#fastmcp-integration-pattern)
    - [Architecture Components](#architecture-components)
    - [FastMCP Key Features](#fastmcp-key-features)
  - [Communication Protocols](#communication-protocols)
    - [JSON-RPC over HTTP](#json-rpc-over-http)
    - [Server-Sent Events (SSE)](#server-sent-events-sse)
  - [Deployment Models](#deployment-models)
    - [Centralized Gateway](#centralized-gateway)
    - [Federated Servers](#federated-servers)
  - [Scalability Patterns](#scalability-patterns)
    - [Horizontal Scaling](#horizontal-scaling)
    - [Vertical Scaling](#vertical-scaling)
  - [High Availability](#high-availability)
    - [Redundancy](#redundancy)
    - [Health Monitoring](#health-monitoring)
    - [Graceful Degradation](#graceful-degradation)
  - [Security Boundaries](#security-boundaries)
    - [Trust Zones](#trust-zones)
    - [Network Policies](#network-policies)
  - [Summary](#summary)
- [Architecture Decision Records (ADRs)](#architecture-decision-records-adrs)
  - [Quick Links](#quick-links)
  - [Introduction](#introduction)
  - [Decision Record Format](#decision-record-format)
  - [ADR-001: FastMCP Framework vs Native SDK](#adr-001-fastmcp-framework-vs-native-sdk)
    - [Context](#context)
    - [Alternatives Considered](#alternatives-considered)
    - [Decision](#decision)
    - [Rationale](#rationale)
    - [Consequences](#consequences)
    - [Review Date](#review-date)
  - [ADR-002: JWT/JWKS vs mTLS Authentication](#adr-002-jwtjwks-vs-mtls-authentication)
    - [Context](#context)
    - [Alternatives Considered](#alternatives-considered)
    - [Decision](#decision)
    - [Rationale](#rationale)
    - [Consequences](#consequences)
    - [Mitigations](#mitigations)
    - [Implementation Notes](#implementation-notes)
- [Standard JWT configuration](#standard-jwt-configuration)
  - [ADR-003: Stateless vs Stateful Server Design](#adr-003-stateless-vs-stateful-server-design)
    - [Context](#context)
    - [Alternatives Considered](#alternatives-considered)
    - [Decision](#decision)
    - [Rationale](#rationale)
    - [Consequences](#consequences)
    - [Implementation Pattern](#implementation-pattern)
- [Stateless tool execution](#stateless-tool-execution)
  - [ADR-004: Database Selection for Tool Metadata](#adr-004-database-selection-for-tool-metadata)
    - [Context](#context)
    - [Alternatives Considered](#alternatives-considered)
    - [Decision](#decision)
    - [Rationale](#rationale)
    - [Consequences](#consequences)
    - [Schema Design](#schema-design)
  - [ADR-005: HTTP/SSE vs WebSocket Transport](#adr-005-httpsse-vs-websocket-transport)
    - [Context](#context)
    - [Alternatives Considered](#alternatives-considered)
    - [Decision](#decision)
    - [Rationale](#rationale)
    - [Consequences](#consequences)
    - [When to Use WebSocket](#when-to-use-websocket)
  - [Decision Process Guidelines](#decision-process-guidelines)
    - [When to Create an ADR](#when-to-create-an-adr)
    - [ADR Review Process](#adr-review-process)
    - [Updating ADRs](#updating-adrs)
    - [ADR Template](#adr-template)
  - [ADR-XXX: [Decision Title]](#adr-xxx-decision-title)
    - [Context](#context)
    - [Alternatives Considered](#alternatives-considered)
    - [Decision](#decision)
    - [Rationale](#rationale)
    - [Consequences](#consequences)
    - [Review Date](#review-date)
- [Security Architecture](#security-architecture)
  - [Quick Links](#quick-links)
  - [Introduction](#introduction)
  - [Zero Trust Principles](#zero-trust-principles)
    - [Core Tenets](#core-tenets)
    - [Trust Decision Flow](#trust-decision-flow)
  - [Defense in Depth](#defense-in-depth)
    - [Security Zones & Trust Boundaries](#security-zones-trust-boundaries)
- [Firewall 1: Internet → DMZ](#firewall-1-internet-dmz)
- [Firewall 2: DMZ → Application Zone](#firewall-2-dmz-application-zone)
- [Firewall 3: Application → Data Zone](#firewall-3-application-data-zone)
- [Restrict MCP Server egress to only database and cache](#restrict-mcp-server-egress-to-only-database-and-cache)
    - [Defense in Depth Layers](#defense-in-depth-layers)
  - [Threat Modeling](#threat-modeling)
    - [STRIDE Analysis](#stride-analysis)
- [JWT with short expiration and refresh tokens](#jwt-with-short-expiration-and-refresh-tokens)
- [Validate token freshness](#validate-token-freshness)
- [Message integrity verification](#message-integrity-verification)
- [SQL injection prevention](#sql-injection-prevention)
- [Immutable audit log entry with signature](#immutable-audit-log-entry-with-signature)
- [Safe error responses](#safe-error-responses)
- [Request size and complexity limits](#request-size-and-complexity-limits)
- [Explicit privilege checks](#explicit-privilege-checks)
    - [Threat Model Summary](#threat-model-summary)
  - [Authentication Patterns](#authentication-patterns)
    - [OAuth 2.1 Authorization (HTTP Transport)](#oauth-21-authorization-http-transport)
- [Configure OAuth 2.1 with PKCE](#configure-oauth-21-with-pkce)
    - [Multi-Provider Support](#multi-provider-support)
- [Configure JWT authentication](#configure-jwt-authentication)
- [Use in FastMCP server](#use-in-fastmcp-server)
    - [API Key Authentication](#api-key-authentication)
  - [FastMCP v3 Security Middleware](#fastmcp-v3-security-middleware)
    - [Security Middleware Stack](#security-middleware-stack)
- [── Authentication Provider ──────────────────────────────────](#-authentication-provider-)
- [── Middleware Stack (order matters: first added = outermost) ─](#-middleware-stack-order-matters-first-added-outermost-)
- [Layer 1: Error handling (catches all exceptions from inner layers)](#layer-1-error-handling-catches-all-exceptions-from-inner-layers)
- [Layer 2: Rate limiting (reject before expensive operations)](#layer-2-rate-limiting-reject-before-expensive-operations)
- [Layer 3: Authorization (per-tool RBAC + capability checks)](#layer-3-authorization-per-tool-rbac-capability-checks)
- [Layer 4: Audit logging (record all requests/responses)](#layer-4-audit-logging-record-all-requestsresponses)
- [Layer 5: Input sanitization](#layer-5-input-sanitization)
- [Layer 6: Response limiting (prevent context window overflow)](#layer-6-response-limiting-prevent-context-window-overflow)
- [Layer 7: Timing (performance monitoring, innermost)](#layer-7-timing-performance-monitoring-innermost)
- [Layer 8: Structured logging (JSON for aggregation)](#layer-8-structured-logging-json-for-aggregation)
    - [Custom RBAC Middleware](#custom-rbac-middleware)
    - [Custom Audit Middleware](#custom-audit-middleware)
    - [Input Sanitization Middleware](#input-sanitization-middleware)
    - [Middleware Composition with Mounted Servers](#middleware-composition-with-mounted-servers)
- [Public server: minimal auth, read-only](#public-server-minimal-auth-read-only)
- [Admin server: strict auth, full access](#admin-server-strict-auth-full-access)
- [Parent server: global security controls](#parent-server-global-security-controls)
- [Mount with namespace isolation](#mount-with-namespace-isolation)
- [Request flow:](#request-flow)
- [public/tool → ErrorHandling → Audit → RateLimit → tool handler](#publictool-errorhandling-audit-ratelimit-tool-handler)
- [admin/tool → ErrorHandling → Audit → RBAC → tool handler](#admintool-errorhandling-audit-rbac-tool-handler)
  - [Authorization Framework](#authorization-framework)
    - [Role-Based Access Control (RBAC)](#role-based-access-control-rbac)
- [Define role hierarchy](#define-role-hierarchy)
    - [Capability-Based Access Control](#capability-based-access-control)
- [Define capabilities](#define-capabilities)
- [Assign capabilities to roles](#assign-capabilities-to-roles)
  - [Rate Limiting](#rate-limiting)
    - [Token Bucket Algorithm](#token-bucket-algorithm)
    - [Multi-Tier Rate Limiting](#multi-tier-rate-limiting)
    - [Rate Limit Headers](#rate-limit-headers)
  - [Input Validation](#input-validation)
    - [Pydantic Models](#pydantic-models)
    - [SQL Injection Prevention](#sql-injection-prevention)
- [❌ NEVER do this](#-never-do-this)
- [✅ Always use parameterized queries](#-always-use-parameterized-queries)
    - [Path Traversal Prevention](#path-traversal-prevention)
    - [Command Injection Prevention](#command-injection-prevention)
- [❌ NEVER do this](#-never-do-this)
- [✅ Use subprocess with argument list](#-use-subprocess-with-argument-list)
  - [Security Headers](#security-headers)
    - [Standard Headers](#standard-headers)
    - [CORS Configuration](#cors-configuration)
  - [Audit Logging](#audit-logging)
    - [Audit Event Structure](#audit-event-structure)
    - [Events to Audit](#events-to-audit)
    - [Sensitive Data Handling](#sensitive-data-handling)
  - [Security Testing Tools](#security-testing-tools)
    - [Static Analysis](#static-analysis)
- [.bandit.yaml](#bandityaml)
- [Ignore test fixtures](#ignore-test-fixtures)
- [Scan entire project](#scan-entire-project)
- [CI/CD integration](#cicd-integration)
- [Exclude specific files](#exclude-specific-files)
- [BAD: Hardcoded password](#bad-hardcoded-password)
- [BAD: Use of eval](#bad-use-of-eval)
- [BAD: Weak random for tokens](#bad-weak-random-for-tokens)
- [GOOD: Secure alternatives](#good-secure-alternatives)
- [Don't use eval, parse safely instead](#dont-use-eval-parse-safely-instead)
- [Check installed packages](#check-installed-packages)
- [Check requirements file](#check-requirements-file)
- [Generate JSON report](#generate-json-report)
- [CI/CD with exit codes](#cicd-with-exit-codes)
- [.safety-policy.yml](#safety-policyyml)
- [Run all rules](#run-all-rules)
- [Use community rules](#use-community-rules)
- [CI/CD mode](#cicd-mode)
- [Generate SARIF output for GitHub](#generate-sarif-output-for-github)
    - [Dynamic Testing](#dynamic-testing)
- [Enumerate endpoints](#enumerate-endpoints)
- [DNS reconnaissance](#dns-reconnaissance)
- [Certificate inspection](#certificate-inspection)
- [Test JWT validation](#test-jwt-validation)
- [- Expired tokens](#-expired-tokens)
- [- Invalid signatures (modify payload)](#-invalid-signatures-modify-payload)
- [- Algorithm confusion (none, HS256 vs RS256)](#-algorithm-confusion-none-hs256-vs-rs256)
- [- Missing required claims](#-missing-required-claims)
- [Brute force prevention](#brute-force-prevention)
- [Token enumeration](#token-enumeration)
- [Try sequential token IDs, predictable patterns](#try-sequential-token-ids-predictable-patterns)
- [Horizontal privilege escalation](#horizontal-privilege-escalation)
- [User A tries to access User B's resources](#user-a-tries-to-access-user-bs-resources)
- [Vertical privilege escalation](#vertical-privilege-escalation)
- [Regular user tries admin endpoints](#regular-user-tries-admin-endpoints)
- [IDOR (Insecure Direct Object Reference)](#idor-insecure-direct-object-reference)
- [Test sequential IDs, GUIDs](#test-sequential-ids-guids)
- [SQL Injection](#sql-injection)
- [Command Injection](#command-injection)
- [Path Traversal](#path-traversal)
- [XXE (XML External Entity)](#xxe-xml-external-entity)
- [SSRF (Server-Side Request Forgery)](#ssrf-server-side-request-forgery)
- [OWASP ZAP (Web scanner)](#owasp-zap-web-scanner)
- [Burp Suite (Manual + automated)](#burp-suite-manual-automated)
- [Configure proxy, spider, active scan](#configure-proxy-spider-active-scan)
- [Nuclei (Vulnerability scanner)](#nuclei-vulnerability-scanner)
    - [Security Incident Response Procedures](#security-incident-response-procedures)
- [Anomaly detection example](#anomaly-detection-example)
- [Revoke compromised credentials](#revoke-compromised-credentials)
- [Block IP address](#block-ip-address)
- [Isolate affected service](#isolate-affected-service)
  - [Incident Report Template](#incident-report-template)
    - [Summary](#summary)
    - [Timeline](#timeline)
    - [Root Cause](#root-cause)
    - [Impact](#impact)
    - [Response Actions](#response-actions)
    - [Lessons Learned](#lessons-learned)
    - [Remediation](#remediation)
    - [Follow-up](#follow-up)
    - [Vulnerability Disclosure Policy](#vulnerability-disclosure-policy)
- [Vulnerability Disclosure Policy](#vulnerability-disclosure-policy)
  - [Scope](#scope)
  - [How to Report](#how-to-report)
  - [Information to Include](#information-to-include)
  - [Safe Harbor](#safe-harbor)
  - [Response Timeline](#response-timeline)
  - [Recognition](#recognition)
  - [Severity Classification](#severity-classification)
  - [Contact](#contact)
  - [Cryptographic Standards](#cryptographic-standards)
    - [Approved Algorithms](#approved-algorithms)
    - [Prohibited Algorithms](#prohibited-algorithms)
    - [TLS Configuration](#tls-configuration)
- [Production TLS configuration](#production-tls-configuration)
  - [Secret Management](#secret-management)
    - [Secret Lifecycle](#secret-lifecycle)
    - [Implementation Patterns](#implementation-patterns)
- [Usage in FastMCP server](#usage-in-fastmcp-server)
    - [Secret Rotation Policy](#secret-rotation-policy)
  - [Session Management](#session-management)
    - [Session Security Controls](#session-security-controls)
    - [Session Security Requirements](#session-security-requirements)
  - [Supply Chain Security](#supply-chain-security)
    - [SLSA Framework Compliance](#slsa-framework-compliance)
    - [Container Security (ADR-007)](#container-security-adr-007)
- [── Build Stage (Alpine) ─────────────────────────────────────](#-build-stage-alpine-)
- [Install build dependencies](#install-build-dependencies)
- [Create non-root user for build](#create-non-root-user-for-build)
- [Install Python dependencies](#install-python-dependencies)
- [── Runtime Stage (Distroless) ───────────────────────────────](#-runtime-stage-distroless-)
- [Copy only runtime artifacts (no shell, no package manager)](#copy-only-runtime-artifacts-no-shell-no-package-manager)
- [Read-only filesystem, non-root, minimal capabilities](#read-only-filesystem-non-root-minimal-capabilities)
    - [Dependency Scanning Pipeline](#dependency-scanning-pipeline)
- [.github/workflows/security-scan.yml](#githubworkflowssecurity-scanyml)
    - [Artifact Verification](#artifact-verification)
- [Verify container signature before deployment](#verify-container-signature-before-deployment)
- [Verify SBOM](#verify-sbom)
- [Verify SLSA provenance](#verify-slsa-provenance)
  - [Security Checklist](#security-checklist)
    - [Zero Trust & Architecture](#zero-trust-architecture)
    - [Authentication (ADR-003)](#authentication-adr-003)
    - [FastMCP v3 Security Middleware (ADR-002)](#fastmcp-v3-security-middleware-adr-002)
    - [Authorization](#authorization)
    - [Input Validation](#input-validation)
    - [Cryptographic Standards](#cryptographic-standards)
    - [Secret Management](#secret-management)
    - [Session Management](#session-management)
    - [Audit & Monitoring](#audit-monitoring)
    - [Transport Security](#transport-security)
    - [Supply Chain Security (ADR-007)](#supply-chain-security-adr-007)
  - [MCP Transport Security (2025-11-25)](#mcp-transport-security-2025-11-25)
    - [Origin Header Validation](#origin-header-validation)
    - [Token Audience Binding (RFC 8707)](#token-audience-binding-rfc-8707)
- [Client includes resource indicator in token request](#client-includes-resource-indicator-in-token-request)
    - [Scope Minimization](#scope-minimization)
    - [SSRF Mitigation for MCP Tools](#ssrf-mitigation-for-mcp-tools)
    - [Session Hijacking and Prompt Injection](#session-hijacking-and-prompt-injection)
    - [Local MCP Server Security](#local-mcp-server-security)
  - [Summary](#summary)
- [Data Privacy & Compliance](#data-privacy-compliance)
  - [Introduction](#introduction)
  - [Regulatory Overview](#regulatory-overview)
    - [Key Regulations](#key-regulations)
    - [Compliance Checklist](#compliance-checklist)
  - [PII Detection & Classification](#pii-detection-classification)
    - [Automatic PII Detection](#automatic-pii-detection)
- [src/mcp_server/privacy/detector.py](#srcmcpserverprivacydetectorpy)
- [Global detector](#global-detector)
    - [Data Classification](#data-classification)
- [src/mcp_server/privacy/classification.py](#srcmcpserverprivacyclassificationpy)
- [Schema registry with classifications](#schema-registry-with-classifications)
  - [PII Masking & Redaction](#pii-masking-redaction)
    - [Automatic Masking](#automatic-masking)
- [src/mcp_server/privacy/masking.py](#srcmcpserverprivacymaskingpy)
- [Global masker](#global-masker)
    - [Tool Response Masking](#tool-response-masking)
  - [Data Retention & Deletion](#data-retention-deletion)
    - [Retention Policy](#retention-policy)
- [src/mcp_server/privacy/retention.py](#srcmcpserverprivacyretentionpy)
- [Schedule retention enforcement](#schedule-retention-enforcement)
    - [Right to Erasure (GDPR)](#right-to-erasure-gdpr)
  - [Data Access Rights](#data-access-rights)
    - [Right to Access (GDPR Article 15)](#right-to-access-gdpr-article-15)
  - [Consent Management](#consent-management)
    - [Consent Tracking](#consent-tracking)
- [src/mcp_server/privacy/consent.py](#srcmcpserverprivacyconsentpy)
- [Global consent manager](#global-consent-manager)
- [Consent decorator](#consent-decorator)
- [Usage](#usage)
  - [Data Residency](#data-residency)
    - [Geographic Data Placement](#geographic-data-placement)
- [src/mcp_server/privacy/residency.py](#srcmcpserverprivacyresidencypy)
- [Regional routing middleware](#regional-routing-middleware)
  - [Audit Logging for Compliance](#audit-logging-for-compliance)
    - [Comprehensive Audit Trail](#comprehensive-audit-trail)
- [src/mcp_server/privacy/audit.py](#srcmcpserverprivacyauditpy)
- [Global audit log](#global-audit-log)
  - [Privacy Impact Assessment](#privacy-impact-assessment)
    - [Assessment Template](#assessment-template)
  - [Summary](#summary)
- [Requirements Engineering Standards](#requirements-engineering-standards)
  - [Overview](#overview)
  - [Requirements Engineering Fundamentals](#requirements-engineering-fundamentals)
    - [ISO/IEEE 29148 Principles](#isoieee-29148-principles)
    - [Requirements Hierarchy for MCP Servers](#requirements-hierarchy-for-mcp-servers)
  - [EARS: Easy Approach to Requirements Syntax](#ears-easy-approach-to-requirements-syntax)
    - [EARS Benefits for MCP Development](#ears-benefits-for-mcp-development)
    - [EARS Patterns](#ears-patterns)
  - [Agile User Stories](#agile-user-stories)
    - [Story Format](#story-format)
    - [MCP-Specific Story Examples](#mcp-specific-story-examples)
    - [Story Structure Best Practices](#story-structure-best-practices)
    - [Example: Complete Story](#example-complete-story)
  - [[STORY-123] File Upload Tool with Progress](#story-123-file-upload-tool-with-progress)
    - [Acceptance Criteria](#acceptance-criteria)
    - [Technical Notes](#technical-notes)
    - [Definition of Done](#definition-of-done)
  - [Acceptance Criteria](#acceptance-criteria)
    - [Acceptance Criteria Standards](#acceptance-criteria-standards)
    - [Acceptance Criteria Templates](#acceptance-criteria-templates)
    - [Complete Acceptance Criteria Example](#complete-acceptance-criteria-example)
    - [Story: Database Query Tool](#story-database-query-tool)
    - [Acceptance Criteria](#acceptance-criteria)
  - [Requirements for MCP Primitives](#requirements-for-mcp-primitives)
    - [Tool Requirements Pattern](#tool-requirements-pattern)
  - [Tool: [tool_name]](#tool-toolname)
    - [Purpose](#purpose)
    - [Functional Requirements (EARS)](#functional-requirements-ears)
    - [Input Requirements](#input-requirements)
    - [Output Requirements](#output-requirements)
    - [Non-Functional Requirements](#non-functional-requirements)
    - [Acceptance Criteria](#acceptance-criteria)
    - [Example: create_issue Tool](#example-createissue-tool)
  - [Tool: create_issue](#tool-createissue)
    - [Purpose](#purpose)
    - [Functional Requirements (EARS)](#functional-requirements-ears)
    - [Input Requirements](#input-requirements)
    - [Output Requirements](#output-requirements)
    - [Non-Functional Requirements](#non-functional-requirements)
    - [Acceptance Criteria](#acceptance-criteria)
    - [Prompt Requirements Pattern](#prompt-requirements-pattern)
  - [Prompt: [prompt_name]](#prompt-promptname)
    - [Purpose](#purpose)
    - [Workflow Requirements (EARS)](#workflow-requirements-ears)
    - [Parameter Requirements](#parameter-requirements)
    - [Output Requirements](#output-requirements)
    - [Acceptance Criteria](#acceptance-criteria)
    - [Resource Requirements Pattern](#resource-requirements-pattern)
  - [Resource: [resource_uri_pattern]](#resource-resourceuripattern)
    - [Purpose](#purpose)
    - [Access Requirements (EARS)](#access-requirements-ears)
    - [URI Template](#uri-template)
    - [Data Requirements](#data-requirements)
    - [Acceptance Criteria](#acceptance-criteria)
  - [Requirements Traceability](#requirements-traceability)
    - [Traceability Matrix](#traceability-matrix)
- [Global traceability registry](#global-traceability-registry)
- [In CI/CD pipeline or development workflow](#in-cicd-pipeline-or-development-workflow)
- [Requirements Traceability Report](#requirements-traceability-report)
  - [REQ-TOOL-001](#req-tool-001)
    - [Implementations](#implementations)
    - [Tests](#tests)
  - [REQ-SEC-005](#req-sec-005)
    - [Implementations](#implementations)
    - [Tests](#tests)
    - [Requirements Tracking](#requirements-tracking)
  - [Requirements Documentation Workflow](#requirements-documentation-workflow)
    - [1. Requirements Elicitation](#1-requirements-elicitation)
    - [2. Requirements Analysis](#2-requirements-analysis)
    - [3. Requirements Documentation](#3-requirements-documentation)
- [Epic: [Epic Name]](#epic-epic-name)
  - [Background](#background)
  - [User Stories](#user-stories)
    - [[STORY-001] Story Title](#story-001-story-title)
  - [Technical Requirements (ISO/IEEE 29148)](#technical-requirements-isoieee-29148)
    - [Functional Requirements](#functional-requirements)
    - [Non-Functional Requirements](#non-functional-requirements)
  - [Traceability](#traceability)
    - [4. Requirements Review](#4-requirements-review)
    - [5. Requirements Baseline](#5-requirements-baseline)
  - [Anti-Patterns to Avoid](#anti-patterns-to-avoid)
    - [❌ Poor Requirements](#-poor-requirements)
    - [✅ Good Requirements](#-good-requirements)
  - [Requirements Tools and Templates](#requirements-tools-and-templates)
    - [Story Template](#story-template)
  - [[STORY-XXX] [Brief Title]](#story-xxx-brief-title)
    - [Context](#context)
    - [EARS Requirements](#ears-requirements)
    - [Acceptance Criteria](#acceptance-criteria)
    - [Technical Notes](#technical-notes)
    - [Definition of Done](#definition-of-done)
    - [Requirements Review Checklist](#requirements-review-checklist)
  - [Requirements Quality Review](#requirements-quality-review)
    - [Completeness](#completeness)
    - [EARS Compliance](#ears-compliance)
    - [Testability](#testability)
    - [ISO/IEEE 29148 Characteristics](#isoieee-29148-characteristics)
    - [Traceability](#traceability)
  - [Summary](#summary)
- [Tool Implementation Standards](#tool-implementation-standards)
  - [Quick Links](#quick-links)
  - [Introduction](#introduction)
  - [Naming Conventions](#naming-conventions)
    - [Verb-Noun Pattern](#verb-noun-pattern)
- [✅ Good - Clear verb-noun pattern](#-good-clear-verb-noun-pattern)
- [❌ Bad - Unclear or inconsistent naming](#-bad-unclear-or-inconsistent-naming)
    - [Standard Verbs](#standard-verbs)
    - [Noun Naming](#noun-naming)
    - [Avoid Abbreviations](#avoid-abbreviations)
- [✅ Good - Clear, spelled out](#-good-clear-spelled-out)
- [⚠️ Acceptable - Industry standard](#-acceptable-industry-standard)
- [❌ Bad - Unclear abbreviations](#-bad-unclear-abbreviations)
    - [MCP 2025-11-25 Naming Rules](#mcp-2025-11-25-naming-rules)
  - [Tool Metadata (MCP 2025-11-25)](#tool-metadata-mcp-2025-11-25)
    - [Title, Icons, and Display Metadata](#title-icons-and-display-metadata)
    - [Output Schema and Structured Content](#output-schema-and-structured-content)
    - [JSON Schema Dialect](#json-schema-dialect)
    - [Content Types in Tool Results](#content-types-in-tool-results)
- [Audio content in tool result](#audio-content-in-tool-result)
- [Resource link in tool result](#resource-link-in-tool-result)
  - [Parameter Design](#parameter-design)
    - [Required vs Optional](#required-vs-optional)
    - [Parameter Naming](#parameter-naming)
- [✅ Good](#-good)
- [❌ Bad - camelCase](#-bad-camelcase)
    - [Type Annotations](#type-annotations)
    - [Complex Parameters](#complex-parameters)
    - [Default Values](#default-values)
  - [Response Standards](#response-standards)
    - [Consistent Structure](#consistent-structure)
    - [Success Response](#success-response)
    - [Error Response](#error-response)
    - [Pagination Response](#pagination-response)
  - [Error Handling](#error-handling)
    - [Protocol Errors vs Tool Execution Errors](#protocol-errors-vs-tool-execution-errors)
    - [Error Code Framework](#error-code-framework)
    - [Structured Error Responses](#structured-error-responses)
    - [Error Context](#error-context)
- [✅ Good - Actionable error message](#-good-actionable-error-message)
- [❌ Bad - Vague error message](#-bad-vague-error-message)
  - [Documentation Standards](#documentation-standards)
    - [Tool Docstrings](#tool-docstrings)
    - [Parameter Descriptions](#parameter-descriptions)
  - [Versioning Strategy](#versioning-strategy)
    - [Tool Versioning](#tool-versioning)
- [Version 1 - Original](#version-1-original)
- [Version 2 - Breaking change (required new parameter)](#version-2-breaking-change-required-new-parameter)
- [Deprecate v1](#deprecate-v1)
    - [Backward Compatibility](#backward-compatibility)
  - [Testing Standards](#testing-standards)
    - [Unit Tests for Tools](#unit-tests-for-tools)
  - [Summary](#summary)
- [Prompt Implementation Standards](#prompt-implementation-standards)
  - [Overview](#overview)
  - [Core Prompt Concepts](#core-prompt-concepts)
    - [User-Controlled Invocation](#user-controlled-invocation)
    - [Prompt Protocol Operations](#prompt-protocol-operations)
  - [Naming and Identification](#naming-and-identification)
    - [Prompt Name Standards](#prompt-name-standards)
    - [Title and Description](#title-and-description)
  - [Parameter Design](#parameter-design)
    - [Argument Structure](#argument-structure)
    - [Argument Best Practices](#argument-best-practices)
- [Core workflow parameters should be required](#core-workflow-parameters-should-be-required)
- [Enhancement parameters should be optional](#enhancement-parameters-should-be-optional)
- [Primitive types for simple inputs](#primitive-types-for-simple-inputs)
- [Complex types for structured data](#complex-types-for-structured-data)
    - [Parameter Completion](#parameter-completion)
  - [Message Construction](#message-construction)
    - [Multi-Message Sequences](#multi-message-sequences)
    - [Content Types](#content-types)
  - [Dynamic Prompt Injection](#dynamic-prompt-injection)
    - [Context-Aware Prompts](#context-aware-prompts)
    - [Tool and Resource Discovery](#tool-and-resource-discovery)
- [List available resources](#list-available-resources)
- [List available tools](#list-available-tools)
- [Build adaptive prompt](#build-adaptive-prompt)
  - [Testing Strategies](#testing-strategies)
    - [Unit Testing Prompts](#unit-testing-prompts)
    - [Integration Testing](#integration-testing)
    - [Parameter Validation Testing](#parameter-validation-testing)
  - [Versioning and Evolution](#versioning-and-evolution)
    - [Prompt Versioning Strategy](#prompt-versioning-strategy)
- [Version 1: Original prompt](#version-1-original-prompt)
- [Version 2: Enhanced with optional parameters](#version-2-enhanced-with-optional-parameters)
    - [Breaking Changes](#breaking-changes)
- [Old prompt (maintained for compatibility)](#old-prompt-maintained-for-compatibility)
- [New prompt with improved interface](#new-prompt-with-improved-interface)
  - [Prompt Chaining and Composition](#prompt-chaining-and-composition)
    - [Multi-Step Workflows](#multi-step-workflows)
    - [Prompt Composition Patterns](#prompt-composition-patterns)
  - [User Interaction Patterns](#user-interaction-patterns)
    - [Discovery Mechanisms](#discovery-mechanisms)
    - [Parameter Input UX](#parameter-input-ux)
    - [Progress and Feedback](#progress-and-feedback)
  - [Security and Access Control](#security-and-access-control)
    - [Sensitive Parameter Handling](#sensitive-parameter-handling)
    - [Authorization Checks](#authorization-checks)
    - [Audit Logging](#audit-logging)
  - [Performance Considerations](#performance-considerations)
    - [Lazy Prompt Generation](#lazy-prompt-generation)
    - [Caching Prompt Definitions](#caching-prompt-definitions)
    - [Streaming Long Prompts](#streaming-long-prompts)
  - [Error Handling](#error-handling)
    - [Validation Errors](#validation-errors)
    - [Resource Unavailability](#resource-unavailability)
    - [Timeout Handling](#timeout-handling)
  - [Documentation and Discovery](#documentation-and-discovery)
    - [Inline Documentation](#inline-documentation)
    - [Example Usage](#example-usage)
- [Basic usage](#basic-usage)
- [With optional parameters](#with-optional-parameters)
- [Error handling](#error-handling)
    - [Metadata for Discovery](#metadata-for-discovery)
  - [Migration and Compatibility](#migration-and-compatibility)
    - [Migrating from String-Based Prompts](#migrating-from-string-based-prompts)
- [Simple string template](#simple-string-template)
- [Manual string interpolation](#manual-string-interpolation)
    - [Backward Compatibility](#backward-compatibility)
- [Support both old and new formats](#support-both-old-and-new-formats)
  - [Related Documentation](#related-documentation)
  - [Summary](#summary)
- [Resource Implementation Standards](#resource-implementation-standards)
  - [Overview](#overview)
  - [Core Resource Concepts](#core-resource-concepts)
    - [Application-Driven Access](#application-driven-access)
    - [Resource Protocol Operations](#resource-protocol-operations)
  - [URI Design Patterns](#uri-design-patterns)
    - [URI Scheme Standards](#uri-scheme-standards)
    - [URI Component Structure](#uri-component-structure)
    - [Static vs. Dynamic Resources](#static-vs-dynamic-resources)
  - [Resource Definition Standards](#resource-definition-standards)
    - [Basic Resource Structure](#basic-resource-structure)
    - [Resource Metadata](#resource-metadata)
  - [MIME Type Handling](#mime-type-handling)
    - [Standard MIME Types](#standard-mime-types)
    - [Content Type Detection](#content-type-detection)
  - [Resource Templates](#resource-templates)
    - [Template URI Patterns](#template-uri-patterns)
    - [Multi-Parameter Templates](#multi-parameter-templates)
    - [Optional Template Parameters](#optional-template-parameters)
  - [Parameter Completion](#parameter-completion)
    - [Implementing Completion Suggestions](#implementing-completion-suggestions)
- [Completion handler for city parameter](#completion-handler-for-city-parameter)
- [Completion handler for date parameter](#completion-handler-for-date-parameter)
    - [Context-Aware Completion](#context-aware-completion)
  - [Data Formatting and Presentation](#data-formatting-and-presentation)
    - [Structured Data (JSON)](#structured-data-json)
    - [Markdown for Rich Text](#markdown-for-rich-text)
    - [Tables and Lists](#tables-and-lists)
  - [Pagination and Large Data](#pagination-and-large-data)
    - [Cursor-Based Pagination](#cursor-based-pagination)
    - [Streaming Large Resources](#streaming-large-resources)
    - [Truncation with Metadata](#truncation-with-metadata)
  - [Resource Subscriptions](#resource-subscriptions)
    - [Change Notifications](#change-notifications)
- [Subscription handler](#subscription-handler)
    - [Polling for Updates](#polling-for-updates)
  - [Access Control and Security](#access-control-and-security)
    - [Resource-Level Permissions](#resource-level-permissions)
    - [Data Redaction](#data-redaction)
    - [Rate Limiting](#rate-limiting)
  - [Caching Strategies](#caching-strategies)
    - [Time-Based Caching](#time-based-caching)
    - [Conditional Requests](#conditional-requests)
  - [Error Handling](#error-handling)
    - [Resource Not Found](#resource-not-found)
    - [Validation Errors](#validation-errors)
    - [Timeout Handling](#timeout-handling)
  - [Testing Strategies](#testing-strategies)
    - [Unit Testing Resources](#unit-testing-resources)
    - [Integration Testing](#integration-testing)
    - [Caching Tests](#caching-tests)
  - [Performance Optimization](#performance-optimization)
    - [Lazy Loading](#lazy-loading)
- [Actual export happens in read handler](#actual-export-happens-in-read-handler)
    - [Parallel Resource Fetching](#parallel-resource-fetching)
    - [Connection Pooling](#connection-pooling)
  - [Documentation and Discovery](#documentation-and-discovery)
    - [Comprehensive Docstrings](#comprehensive-docstrings)
    - [Resource Metadata](#resource-metadata)
  - [Related Documentation](#related-documentation)
  - [Summary](#summary)
- [Sampling Patterns and LLM Interaction](#sampling-patterns-and-llm-interaction)
  - [Overview](#overview)
  - [Core Sampling Concepts](#core-sampling-concepts)
    - [When to Use Sampling](#when-to-use-sampling)
- [Generate documentation from code](#generate-documentation-from-code)
- [Transform data formats (CSV → Markdown)](#transform-data-formats-csv-markdown)
- [Create summaries from long text](#create-summaries-from-long-text)
- [Draft emails or messages](#draft-emails-or-messages)
- [Extract structured data from unstructured text](#extract-structured-data-from-unstructured-text)
- [Classify or categorize content](#classify-or-categorize-content)
- [Identify patterns or anomalies](#identify-patterns-or-anomalies)
- [Sentiment analysis or intent detection](#sentiment-analysis-or-intent-detection)
- [Recommend next actions based on context](#recommend-next-actions-based-on-context)
- [Prioritize tasks or issues](#prioritize-tasks-or-issues)
- [Route requests to appropriate handlers](#route-requests-to-appropriate-handlers)
- [Suggest parameter values](#suggest-parameter-values)
- [Generate code from specifications](#generate-code-from-specifications)
- [Explain or document code](#explain-or-document-code)
- [Suggest refactorings or improvements](#suggest-refactorings-or-improvements)
- [Translate between programming languages](#translate-between-programming-languages)
    - [When NOT to Use Sampling](#when-not-to-use-sampling)
- [BAD: Using sampling for simple arithmetic](#bad-using-sampling-for-simple-arithmetic)
  - [Message Construction](#message-construction)
    - [Basic Sampling Request](#basic-sampling-request)
    - [Multi-Turn Conversations](#multi-turn-conversations)
    - [System Messages for Behavior Control](#system-messages-for-behavior-control)
  - [Model Selection](#model-selection)
    - [Choosing the Right Model](#choosing-the-right-model)
    - [Cost vs. Quality Tradeoffs](#cost-vs-quality-tradeoffs)
  - [Temperature and Sampling Parameters](#temperature-and-sampling-parameters)
    - [Temperature Guidelines](#temperature-guidelines)
    - [Top-P (Nucleus Sampling)](#top-p-nucleus-sampling)
  - [Structured Output Patterns](#structured-output-patterns)
    - [JSON Output](#json-output)
    - [Markdown Output](#markdown-output)
    - [List/Enumeration Output](#listenumeration-output)
  - [Error Handling and Retries](#error-handling-and-retries)
    - [Handling Model Failures](#handling-model-failures)
    - [Fallback Strategies](#fallback-strategies)
    - [Validation and Sanitization](#validation-and-sanitization)
  - [Prompt Engineering Techniques](#prompt-engineering-techniques)
    - [Few-Shot Learning](#few-shot-learning)
    - [Chain of Thought](#chain-of-thought)
    - [Role Playing](#role-playing)
  - [Performance and Cost Optimization](#performance-and-cost-optimization)
    - [Batch Processing](#batch-processing)
    - [Caching Patterns](#caching-patterns)
    - [Token Usage Monitoring](#token-usage-monitoring)
  - [Security and Safety](#security-and-safety)
    - [Content Filtering](#content-filtering)
    - [Prompt Injection Prevention](#prompt-injection-prevention)
    - [Output Validation](#output-validation)
  - [Testing Sampling Implementations](#testing-sampling-implementations)
    - [Mocking LLM Responses](#mocking-llm-responses)
    - [Integration Testing](#integration-testing)
    - [Performance Testing](#performance-testing)
  - [Best Practices Summary](#best-practices-summary)
    - [Do's](#dos)
    - [Don'ts](#donts)
  - [Related Documentation](#related-documentation)
  - [Tools in Sampling (MCP 2025-11-25)](#tools-in-sampling-mcp-2025-11-25)
    - [Client Capability](#client-capability)
    - [Sampling Request with Tools](#sampling-request-with-tools)
    - [toolChoice Modes](#toolchoice-modes)
    - [Multi-Turn Tool Loop](#multi-turn-tool-loop)
    - [Message Content Constraints](#message-content-constraints)
  - [Summary](#summary)
- [Decision Trees](#decision-trees)
  - [Introduction](#introduction)
  - [When to Use MCP vs REST API](#when-to-use-mcp-vs-rest-api)
  - [Tool vs Prompt vs Resource Selection](#tool-vs-prompt-vs-resource-selection)
  - [Authentication Method Selection](#authentication-method-selection)
  - [Caching Strategy Selection](#caching-strategy-selection)
- [Cache-Aside (Lazy Loading)](#cache-aside-lazy-loading)
- [Write-Through (Immediate consistency)](#write-through-immediate-consistency)
- [Refresh-Ahead (Background refresh)](#refresh-ahead-background-refresh)
  - [Database Technology Selection](#database-technology-selection)
- [PostgreSQL for main data](#postgresql-for-main-data)
- [Redis for caching](#redis-for-caching)
- [Connection pooling](#connection-pooling)
  - [Deployment Model Selection](#deployment-model-selection)
  - [Error Recovery Strategy](#error-recovery-strategy)
  - [Summary](#summary)
- [Integration Patterns](#integration-patterns)
  - [Introduction](#introduction)
  - [External API Integration](#external-api-integration)
    - [HTTP Client Configuration](#http-client-configuration)
- [src/mcp_server/clients/http_client.py](#srcmcpserverclientshttpclientpy)
    - [API Client Example](#api-client-example)
- [src/mcp_server/clients/external_api.py](#srcmcpserverclientsexternalapipy)
  - [Caching Strategies](#caching-strategies)
    - [Multi-Tier Cache Implementation](#multi-tier-cache-implementation)
- [src/mcp_server/services/cache.py](#srcmcpserverservicescachepy)
- [Global cache instance](#global-cache-instance)
    - [Cache Usage Pattern](#cache-usage-pattern)
  - [Circuit Breaker Pattern](#circuit-breaker-pattern)
    - [Circuit Breaker Implementation](#circuit-breaker-implementation)
- [src/mcp_server/patterns/circuit_breaker.py](#srcmcpserverpatternscircuitbreakerpy)
    - [Circuit Breaker Usage](#circuit-breaker-usage)
- [Create circuit breaker for external API](#create-circuit-breaker-for-external-api)
  - [Retry Logic](#retry-logic)
    - [Exponential Backoff with Jitter](#exponential-backoff-with-jitter)
- [src/mcp_server/patterns/retry.py](#srcmcpserverpatternsretrypy)
- [Usage example](#usage-example)
  - [Webhook Handling](#webhook-handling)
    - [Webhook Receiver](#webhook-receiver)
- [src/mcp_server/webhooks.py](#srcmcpserverwebhookspy)
  - [Summary](#summary)
- [Elicitation Patterns](#elicitation-patterns)
  - [Introduction](#introduction)
  - [When to Use Elicitation](#when-to-use-elicitation)
  - [Capability Declaration](#capability-declaration)
    - [Sub-Capabilities: Form and URL Modes](#sub-capabilities-form-and-url-modes)
  - [FastMCP v3 Elicitation API](#fastmcp-v3-elicitation-api)
    - [Response Types](#response-types)
    - [Result Pattern Matching](#result-pattern-matching)
    - [Structured Response with Dataclass](#structured-response-with-dataclass)
    - [Default Values with Pydantic](#default-values-with-pydantic)
    - [Multi-Turn Elicitation](#multi-turn-elicitation)
    - [Confirmation (No Data Expected)](#confirmation-no-data-expected)
  - [Supported Input Types](#supported-input-types)
    - [Titled vs Untitled Enum Variants](#titled-vs-untitled-enum-variants)
- [Untitled enum — values displayed directly](#untitled-enum-values-displayed-directly)
- [Titled enum — display labels differ from values](#titled-enum-display-labels-differ-from-values)
  - [Implementation Patterns](#implementation-patterns)
    - [Basic Elicitation](#basic-elicitation)
    - [Confirmation Before Destructive Action](#confirmation-before-destructive-action)
    - [Multi-Field Elicitation](#multi-field-elicitation)
  - [URL Mode Elicitation](#url-mode-elicitation)
    - [URL Mode Request](#url-mode-request)
    - [URL Mode Response](#url-mode-response)
    - [URL Mode Implementation](#url-mode-implementation)
    - [URL Mode Security Considerations](#url-mode-security-considerations)
  - [Error Handling](#error-handling)
    - [Standard Errors](#standard-errors)
    - [MCP Elicitation Error Codes](#mcp-elicitation-error-codes)
    - [Notifications](#notifications)
  - [Testing](#testing)
  - [Summary](#summary)
- [Task Patterns](#task-patterns)
  - [SRS Traceability](#srs-traceability)
  - [Introduction](#introduction)
  - [When to Use Tasks](#when-to-use-tasks)
  - [Capability Declaration](#capability-declaration)
    - [Server Task Capabilities](#server-task-capabilities)
    - [Client Task Capabilities](#client-task-capabilities)
    - [Tool-Level Task Negotiation](#tool-level-task-negotiation)
  - [Task Lifecycle](#task-lifecycle)
    - [Task States](#task-states)
  - [Protocol Methods](#protocol-methods)
    - [Creating a Task](#creating-a-task)
    - [Polling Task Status: `tasks/get`](#polling-task-status-tasksget)
    - [Retrieving Task Result: `tasks/result`](#retrieving-task-result-tasksresult)
    - [Listing Tasks: `tasks/list`](#listing-tasks-taskslist)
    - [Cancelling a Task: `tasks/cancel`](#cancelling-a-task-taskscancel)
  - [Task Fields Reference](#task-fields-reference)
  - [Implementation Patterns](#implementation-patterns)
    - [Basic Task-Enabled Tool](#basic-task-enabled-tool)
- [In-memory task store (use Redis/DB in production)](#in-memory-task-store-use-redisdb-in-production)
    - [Task with Mid-Flight Elicitation (input_required)](#task-with-mid-flight-elicitation-inputrequired)
  - [Two-Way Task Support](#two-way-task-support)
  - [Production Considerations](#production-considerations)
  - [Security Considerations](#security-considerations)
  - [Testing](#testing)
  - [Summary](#summary)
- [Multi-Server Orchestration](#multi-server-orchestration)
  - [Introduction](#introduction)
  - [Architecture](#architecture)
  - [Capability Boundary Declaration](#capability-boundary-declaration)
- [Clear domain boundaries](#clear-domain-boundaries)
- [Separate domain — separate server](#separate-domain-separate-server)
  - [Cross-Server Workflow Patterns](#cross-server-workflow-patterns)
    - [Pattern 1: Sequential Composition](#pattern-1-sequential-composition)
    - [Pattern 2: Parallel Resource Aggregation](#pattern-2-parallel-resource-aggregation)
    - [Pattern 3: Cross-Domain Tool Chains](#pattern-3-cross-domain-tool-chains)
  - [Failure Isolation](#failure-isolation)
- [Recommended per-server timeout values](#recommended-per-server-timeout-values)
- [Circuit breaker configuration](#circuit-breaker-configuration)
  - [Design Guidelines](#design-guidelines)
    - [DO](#do)
    - [DON'T](#dont)
  - [FastMCP v3 Server Composition](#fastmcp-v3-server-composition)
    - [Composition Methods](#composition-methods)
    - [In-Process Mounting](#in-process-mounting)
- [Domain servers](#domain-servers)
- [Gateway server aggregates domains under namespaces](#gateway-server-aggregates-domains-under-namespaces)
- [Clients see:](#clients-see)
- [github_get_latest_release, jira_get_issue, slack_send_message](#githubgetlatestrelease-jiragetissue-slacksendmessage)
- [Resources: github://github/*, jira://jira/*, etc.](#resources-githubgithub-jirajira-etc)
    - [Remote Server Proxy](#remote-server-proxy)
- [Remote HTTP server (Streamable HTTP transport)](#remote-http-server-streamable-http-transport)
- [Subprocess server (stdio transport)](#subprocess-server-stdio-transport)
- [NPM package server](#npm-package-server)
    - [Static Import](#static-import)
- [Static copy — changes to jira_server after this call are NOT reflected](#static-copy-changes-to-jiraserver-after-this-call-are-not-reflected)
    - [Tag-Based Filtering](#tag-based-filtering)
- [Expose only read-only tools from the GitHub server](#expose-only-read-only-tools-from-the-github-server)
- [Or exclude admin tools](#or-exclude-admin-tools)
    - [Direct vs Proxy Mounting](#direct-vs-proxy-mounting)
    - [Composition Architecture](#composition-architecture)
  - [Testing Multi-Server Compositions](#testing-multi-server-compositions)
  - [Summary](#summary)
- [AI Service Provider Gateway](#ai-service-provider-gateway)
  - [Introduction](#introduction)
  - [Architecture](#architecture)
  - [Configuration](#configuration)
    - [Endpoint Configuration](#endpoint-configuration)
- [config/gateway.yaml](#configgatewayyaml)
    - [Rate Limiting](#rate-limiting)
    - [Enterprise Headers](#enterprise-headers)
  - [Implementation](#implementation)
    - [Gateway Client](#gateway-client)
    - [Connectivity Verification](#connectivity-verification)
    - [Failover Logic](#failover-logic)
    - [Credential Rotation](#credential-rotation)
  - [MCP Sampling Integration](#mcp-sampling-integration)
  - [Gateway Testing](#gateway-testing)
  - [Summary](#summary)
- [Testing Strategy](#testing-strategy)
  - [Quick Links](#quick-links)
  - [Introduction](#introduction)
  - [Testing Pyramid](#testing-pyramid)
  - [Unit Testing](#unit-testing)
    - [Tool Unit Tests](#tool-unit-tests)
- [Tool under test](#tool-under-test)
    - [Parametrized Tests](#parametrized-tests)
    - [Fixture Patterns](#fixture-patterns)
  - [Integration Testing](#integration-testing)
    - [Component Integration](#component-integration)
    - [Database Integration](#database-integration)
    - [External Service Integration](#external-service-integration)
  - [End-to-End Testing](#end-to-end-testing)
    - [User Journey Tests](#user-journey-tests)
    - [API E2E Tests](#api-e2e-tests)
  - [Load Testing](#load-testing)
    - [Locust Load Tests](#locust-load-tests)
- [Start load test](#start-load-test)
    - [Performance Benchmarks](#performance-benchmarks)
  - [Security Testing](#security-testing)
    - [Authentication Tests](#authentication-tests)
    - [Authorization Tests](#authorization-tests)
    - [Input Validation Tests](#input-validation-tests)
  - [Coverage Requirements](#coverage-requirements)
    - [Coverage Configuration](#coverage-configuration)
- [.coveragerc or pyproject.toml [tool.coverage]](#coveragerc-or-pyprojecttoml-toolcoverage)
- [Fail build if coverage below threshold](#fail-build-if-coverage-below-threshold)
    - [Coverage Targets](#coverage-targets)
    - [Run Coverage](#run-coverage)
- [Run tests with coverage](#run-tests-with-coverage)
- [View HTML report](#view-html-report)
- [Check coverage threshold](#check-coverage-threshold)
  - [Test Organization](#test-organization)
    - [Directory Structure](#directory-structure)
    - [Test Configuration](#test-configuration)
- [pytest.ini](#pytestini)
- [Markers](#markers)
- [Async support](#async-support)
- [Coverage](#coverage)
- [Ignore warnings](#ignore-warnings)
  - [CI/CD Integration](#cicd-integration)
    - [GitHub Actions Workflow](#github-actions-workflow)
- [.github/workflows/test.yml](#githubworkflowstestyml)
  - [Contract Testing](#contract-testing)
    - [Provider Contract Tests](#provider-contract-tests)
- [tests/contract/test_mcp_protocol.py](#testscontracttestmcpprotocolpy)
    - [Consumer Contract Tests](#consumer-contract-tests)
- [tests/contract/test_github_api.py](#testscontracttestgithubapipy)
    - [Schema Validation Tests](#schema-validation-tests)
- [tests/contract/test_tool_schemas.py](#testscontracttesttoolschemaspy)
  - [Test Data Management Strategies](#test-data-management-strategies)
    - [Fixture-Based Data](#fixture-based-data)
- [tests/fixtures/data.py](#testsfixturesdatapy)
    - [Factory Pattern with Faker](#factory-pattern-with-faker)
- [tests/factories.py](#testsfactoriespy)
- [Usage](#usage)
    - [Snapshot Testing for Response Validation](#snapshot-testing-for-response-validation)
- [tests/snapshots/test_responses.py](#testssnapshotstestresponsespy)
    - [Mock vs Real Service Decision Matrix](#mock-vs-real-service-decision-matrix)
- [Unit Tests: Always mock](#unit-tests-always-mock)
- [Integration Tests: Real database, mock expensive services](#integration-tests-real-database-mock-expensive-services)
  - [Mutation Testing](#mutation-testing)
    - [Setup with mutmut](#setup-with-mutmut)
- [Run all mutations](#run-all-mutations)
- [Show results](#show-results)
- [Show specific mutation](#show-specific-mutation)
- [Apply mutation to see what changed](#apply-mutation-to-see-what-changed)
- [Show survived mutations](#show-survived-mutations)
- [Example survivor](#example-survivor)
- [Original:  if priority > 0:](#original-if-priority-0)
- [Mutated:   if priority >= 0:](#mutated-if-priority-0)
- [Fix: Add test for priority=0 edge case](#fix-add-test-for-priority0-edge-case)
- [Example test improvement from mutation analysis](#example-test-improvement-from-mutation-analysis)
- [Survivor found: changed > to >= in validation](#survivor-found-changed-to-in-validation)
- [Add edge case test:](#add-edge-case-test)
  - [Chaos Engineering for Resilience](#chaos-engineering-for-resilience)
    - [Chaos Testing with pytest-chaos](#chaos-testing-with-pytest-chaos)
- [tests/chaos/test_resilience.py](#testschaostestresiliencepy)
    - [Manual Failure Injection](#manual-failure-injection)
- [tests/chaos/failure_injection.py](#testschaosfailureinjectionpy)
- [Usage](#usage)
    - [Network Partition Testing](#network-partition-testing)
- [tests/chaos/test_network_partitions.py](#testschaostestnetworkpartitionspy)
  - [Performance Regression Testing](#performance-regression-testing)
    - [Setup with pytest-benchmark](#setup-with-pytest-benchmark)
- [tests/performance/test_benchmarks.py](#testsperformancetestbenchmarkspy)
- [Run and save baseline](#run-and-save-baseline)
- [Compare against baseline](#compare-against-baseline)
- [Fail if regression > 10%](#fail-if-regression-10)
    - [Custom Performance Metrics](#custom-performance-metrics)
- [tests/performance/metrics.py](#testsperformancemetricspy)
    - [Load Testing with Locust](#load-testing-with-locust)
- [tests/performance/locustfile.py](#testsperformancelocustfilepy)
- [Web UI](#web-ui)
- [Headless (CI/CD)](#headless-cicd)
- [tests/performance/test_slo.py](#testsperformancetestslopy)
  - [Summary](#summary)
- [Observability](#observability)
  - [Quick Links](#quick-links)
  - [Introduction](#introduction)
  - [Three Pillars of Observability](#three-pillars-of-observability)
    - [1. Collection & Ingestion Pipeline](#1-collection-ingestion-pipeline)
    - [2. Storage & Retention Architecture](#2-storage-retention-architecture)
    - [3. Analysis & Visualization Layer](#3-analysis-visualization-layer)
  - [Structured Logging](#structured-logging)
    - [Logging Configuration](#logging-configuration)
- [Initialize at startup](#initialize-at-startup)
    - [Structured Log Format](#structured-log-format)
- [Context variables for correlation](#context-variables-for-correlation)
- [Global logger instance](#global-logger-instance)
    - [Logging in Tools](#logging-in-tools)
    - [Log Levels](#log-levels)
- [DEBUG - Detailed diagnostic information](#debug-detailed-diagnostic-information)
- [INFO - Significant events](#info-significant-events)
- [WARNING - Potential issues](#warning-potential-issues)
- [ERROR - Errors requiring attention](#error-errors-requiring-attention)
- [CRITICAL - System failures](#critical-system-failures)
    - [Log Aggregation](#log-aggregation)
- [Filebeat configuration for log shipping](#filebeat-configuration-for-log-shipping)
  - [Metrics](#metrics)
    - [OpenTelemetry Metrics](#opentelemetry-metrics)
- [Initialize meter](#initialize-meter)
- [Create instruments](#create-instruments)
    - [Instrumenting Tools](#instrumenting-tools)
- [Get tracer](#get-tracer)
    - [Custom Business Metrics](#custom-business-metrics)
- [Business-specific metrics](#business-specific-metrics)
    - [Grafana Dashboard](#grafana-dashboard)
  - [Distributed Tracing](#distributed-tracing)
    - [OpenTelemetry Tracing](#opentelemetry-tracing)
    - [Manual Span Creation](#manual-span-creation)
    - [Cross-Service Tracing](#cross-service-tracing)
  - [Health Checks](#health-checks)
    - [Health Check Endpoints](#health-check-endpoints)
    - [Kubernetes Probes](#kubernetes-probes)
- [deployment.yaml](#deploymentyaml)
  - [Alerting](#alerting)
    - [Alert Rules](#alert-rules)
- [Prometheus alert rules](#prometheus-alert-rules)
    - [Alert Destinations](#alert-destinations)
- [AlertManager configuration](#alertmanager-configuration)
  - [Grafana Dashboard Management](#grafana-dashboard-management)
    - [Dashboard Exports](#dashboard-exports)
    - [Importing Dashboards](#importing-dashboards)
- [Using Grafana API](#using-grafana-api)
- [Using Terraform](#using-terraform)
- [terraform/grafana.tf](#terraformgrafanatf)
- [Using ConfigMap (Kubernetes)](#using-configmap-kubernetes)
- [provisioning/dashboards/mcp.yaml](#provisioningdashboardsmcpyaml)
    - [Dashboard Best Practices](#dashboard-best-practices)
  - [Prometheus Recording Rules](#prometheus-recording-rules)
    - [Configuration](#configuration)
- [prometheus/rules/mcp_recording_rules.yaml](#prometheusrulesmcprecordingrulesyaml)
- [Validate rules](#validate-rules)
- [Reload Prometheus](#reload-prometheus)
- [Or via Kubernetes ConfigMap](#or-via-kubernetes-configmap)
- [Before (expensive query)](#before-expensive-query)
- [After (fast lookup)](#after-fast-lookup)
  - [Alert Fatigue Prevention Strategies](#alert-fatigue-prevention-strategies)
    - [1. Alert Prioritization Framework](#1-alert-prioritization-framework)
- [prometheus/rules/mcp_alerts_prioritized.yaml](#prometheusrulesmcpalertsprioritizedyaml)
    - [2. Alert Routing by Priority](#2-alert-routing-by-priority)
- [alertmanager/config.yml](#alertmanagerconfigyml)
    - [3. Alert Aggregation & Deduplication](#3-alert-aggregation-deduplication)
- [Aggregate correlated alerts](#aggregate-correlated-alerts)
    - [4. Alert Silencing & Maintenance Windows](#4-alert-silencing-maintenance-windows)
- [Silence alerts during deployment](#silence-alerts-during-deployment)
- [Scheduled maintenance silence](#scheduled-maintenance-silence)
- [k8s/deployment.yaml](#k8sdeploymentyaml)
    - [5. Alert Quality Metrics](#5-alert-quality-metrics)
- [Track alert effectiveness](#track-alert-effectiveness)
- [Alert review process](#alert-review-process)
- [Alert firing rate](#alert-firing-rate)
- [False positive rate by alert](#false-positive-rate-by-alert)
- [Average time to resolution](#average-time-to-resolution)
  - [Synthetic Monitoring](#synthetic-monitoring)
    - [1. Blackbox Exporter Setup](#1-blackbox-exporter-setup)
- [blackbox-exporter/config.yml](#blackbox-exporterconfigyml)
- [Prometheus scrape config](#prometheus-scrape-config)
    - [2. Multi-Region Synthetic Tests](#2-multi-region-synthetic-tests)
- [synthetic_tests/test_api_availability.py](#syntheticteststestapiavailabilitypy)
    - [3. Synthetic Monitoring Alerts](#3-synthetic-monitoring-alerts)
- [prometheus/rules/synthetic_alerts.yaml](#prometheusrulessyntheticalertsyaml)
  - [Real User Monitoring (RUM)](#real-user-monitoring-rum)
    - [1. RUM JavaScript SDK](#1-rum-javascript-sdk)
    - [2. RUM Backend Ingestion](#2-rum-backend-ingestion)
- [rum_ingest/server.py](#rumingestserverpy)
- [Metrics](#metrics)
    - [3. RUM Analytics Queries](#3-rum-analytics-queries)
  - [Cloud Cost Monitoring](#cloud-cost-monitoring)
    - [1. Cost Metric Collection](#1-cost-metric-collection)
- [cost_exporter/aws_cost_collector.py](#costexporterawscostcollectorpy)
    - [2. Cost Optimization Recommendations](#2-cost-optimization-recommendations)
- [cost_optimizer/analyzer.py](#costoptimizeranalyzerpy)
    - [3. Cost Alerts](#3-cost-alerts)
- [prometheus/rules/cost_alerts.yaml](#prometheusrulescostalertsyaml)
  - [Summary](#summary)
- [Development Lifecycle](#development-lifecycle)
  - [Introduction](#introduction)
  - [Project Structure](#project-structure)
    - [Standard Directory Layout](#standard-directory-layout)
    - [Module Organization](#module-organization)
- [src/mcp_server/__init__.py](#srcmcpserverinitpy)
- [src/mcp_server/tools/__init__.py](#srcmcpservertoolsinitpy)
  - [Configuration Management](#configuration-management)
    - [Configuration Structure](#configuration-structure)
- [src/mcp_server/config.py](#srcmcpserverconfigpy)
- [Global config instance](#global-config-instance)
    - [Environment-Specific Configuration](#environment-specific-configuration)
- [config/development.yaml](#configdevelopmentyaml)
- [config/production.yaml](#configproductionyaml)
    - [Secrets Management](#secrets-management)
- [Use environment variables for secrets in production](#use-environment-variables-for-secrets-in-production)
  - [Dependency Management](#dependency-management)
    - [Requirements Files](#requirements-files)
- [requirements.txt - Production dependencies](#requirementstxt-production-dependencies)
- [requirements-dev.txt - Development dependencies](#requirements-devtxt-development-dependencies)
- [Testing](#testing)
- [Linting & Formatting](#linting-formatting)
- [Documentation](#documentation)
- [Development Tools](#development-tools)
    - [Python Package Configuration](#python-package-configuration)
- [pyproject.toml](#pyprojecttoml)
  - [Version Control](#version-control)
    - [Git Workflow](#git-workflow)
    - [Branch Naming](#branch-naming)
- [Feature branches](#feature-branches)
- [Bugfix branches](#bugfix-branches)
- [Hotfix branches (for production)](#hotfix-branches-for-production)
- [Release branches](#release-branches)
    - [Commit Messages](#commit-messages)
- [Format](#format)
- [Types](#types)
- [Examples](#examples)
    - [Git Hooks](#git-hooks)
- [.git/hooks/pre-commit](#githookspre-commit)
- [Run linting](#run-linting)
- [Run type checking](#run-type-checking)
- [Run tests](#run-tests)
  - [Development Workflows](#development-workflows)
    - [Local Development Setup](#local-development-setup)
- [scripts/setup.sh](#scriptssetupsh)
- [Check Python version](#check-python-version)
- [Create virtual environment](#create-virtual-environment)
- [Install dependencies](#install-dependencies)
- [Setup pre-commit hooks](#setup-pre-commit-hooks)
- [Create .env file](#create-env-file)
- [Setup database](#setup-database)
- [Wait for database](#wait-for-database)
- [Run migrations](#run-migrations)
- [Seed data](#seed-data)
    - [Running Locally](#running-locally)
- [Start dependencies](#start-dependencies)
- [Activate virtual environment](#activate-virtual-environment)
- [Run server in development mode](#run-server-in-development-mode)
- [Or use the package entry point](#or-use-the-package-entry-point)
    - [Development Docker Compose](#development-docker-compose)
- [docker-compose.yml](#docker-composeyml)
  - [Code Quality](#code-quality)
    - [Pre-commit Configuration](#pre-commit-configuration)
- [.pre-commit-config.yaml](#pre-commit-configyaml)
    - [Makefile for Common Tasks](#makefile-for-common-tasks)
- [Makefile](#makefile)
  - [Summary](#summary)
- [Performance & Scalability](#performance-scalability)
  - [Introduction](#introduction)
  - [Async I/O Patterns](#async-io-patterns)
    - [When to Use AsyncIO](#when-to-use-asyncio)
- [✅ Good - I/O bound operations benefit from async](#-good-io-bound-operations-benefit-from-async)
- [❌ Bad - CPU-bound work blocks event loop](#-bad-cpu-bound-work-blocks-event-loop)
- [✅ Good - Use thread pool for CPU work](#-good-use-thread-pool-for-cpu-work)
    - [Async Best Practices](#async-best-practices)
    - [Concurrency Control](#concurrency-control)
- [Limit concurrent external API calls](#limit-concurrent-external-api-calls)
  - [Connection Pooling](#connection-pooling)
    - [Database Connection Pool](#database-connection-pool)
- [src/mcp_server/database.py](#srcmcpserverdatabasepy)
- [Global pool instance](#global-pool-instance)
- [Initialize on startup](#initialize-on-startup)
- [Usage in tools](#usage-in-tools)
    - [HTTP Client Pool](#http-client-pool)
- [src/mcp_server/http_pool.py](#srcmcpserverhttppoolpy)
- [Global client](#global-client)
  - [Caching Strategies](#caching-strategies)
    - [Tool Result Caching](#tool-result-caching)
- [src/mcp_server/cache.py](#srcmcpservercachepy)
- [Global cache](#global-cache)
- [Cache decorator](#cache-decorator)
- [Usage](#usage)
    - [When to Cache](#when-to-cache)
    - [Redis-Backed Caching](#redis-backed-caching)
- [src/mcp_server/redis_cache.py](#srcmcpserverrediscachepy)
- [Global Redis cache](#global-redis-cache)
  - [Batch Operations](#batch-operations)
    - [Batching Pattern](#batching-pattern)
    - [DataLoader Pattern](#dataloader-pattern)
- [src/mcp_server/dataloader.py](#srcmcpserverdataloaderpy)
- [Usage](#usage)
  - [Backpressure Handling](#backpressure-handling)
    - [Request Queue Depth Limiting](#request-queue-depth-limiting)
- [src/mcp_server/backpressure.py](#srcmcpserverbackpressurepy)
- [Global request queue](#global-request-queue)
- [Middleware to enforce backpressure](#middleware-to-enforce-backpressure)
    - [Circuit Breaker Pattern](#circuit-breaker-pattern)
- [src/mcp_server/circuit_breaker.py](#srcmcpservercircuitbreakerpy)
- [Usage](#usage)
  - [Performance Monitoring](#performance-monitoring)
    - [Key Metrics](#key-metrics)
- [Track these performance metrics](#track-these-performance-metrics)
    - [Performance Testing](#performance-testing)
- [tests/performance/test_load.py](#testsperformancetestloadpy)
  - [Performance Targets (SRS Alignment)](#performance-targets-srs-alignment)
    - [Latency Budget](#latency-budget)
    - [Capacity Targets](#capacity-targets)
    - [Resilience Targets](#resilience-targets)
    - [Qualitative Design Requirements](#qualitative-design-requirements)
  - [Summary](#summary)
- [Deployment Patterns](#deployment-patterns)
  - [Quick Links](#quick-links)
  - [Introduction](#introduction)
  - [Containerization](#containerization)
    - [Production Dockerfile](#production-dockerfile)
- [Multi-stage build for optimal image size](#multi-stage-build-for-optimal-image-size)
- [Install build dependencies](#install-build-dependencies)
- [Create virtual environment](#create-virtual-environment)
- [Copy requirements and install dependencies](#copy-requirements-and-install-dependencies)
- [Production stage](#production-stage)
- [Install runtime dependencies](#install-runtime-dependencies)
- [Create non-root user](#create-non-root-user)
- [Copy virtual environment from builder](#copy-virtual-environment-from-builder)
- [Set working directory](#set-working-directory)
- [Copy application code](#copy-application-code)
- [Switch to non-root user](#switch-to-non-root-user)
- [Expose port](#expose-port)
- [Health check](#health-check)
- [Run application](#run-application)
    - [Development Dockerfile](#development-dockerfile)
- [Development image with hot reload](#development-image-with-hot-reload)
- [Install dependencies](#install-dependencies)
- [Create app directory](#create-app-directory)
- [Copy requirements](#copy-requirements)
- [Install dependencies](#install-dependencies)
- [Copy application code (will be overridden by volume mount)](#copy-application-code-will-be-overridden-by-volume-mount)
- [Expose port](#expose-port)
- [Run with reload](#run-with-reload)
    - [Docker Compose for Production](#docker-compose-for-production)
- [docker-compose.prod.yml](#docker-composeprodyml)
  - [Production Architecture](#production-architecture)
    - [Complete Deployment Diagram](#complete-deployment-diagram)
    - [Architecture Components](#architecture-components)
  - [Kubernetes Deployment](#kubernetes-deployment)
    - [Deployment Manifest](#deployment-manifest)
- [k8s/deployment.yaml](#k8sdeploymentyaml)
    - [Service Manifest](#service-manifest)
- [k8s/service.yaml](#k8sserviceyaml)
    - [Ingress Configuration](#ingress-configuration)
- [k8s/ingress.yaml](#k8singressyaml)
    - [ConfigMap](#configmap)
- [k8s/configmap.yaml](#k8sconfigmapyaml)
    - [Secrets](#secrets)
- [k8s/secrets.yaml](#k8ssecretsyaml)
    - [Horizontal Pod Autoscaler](#horizontal-pod-autoscaler)
- [k8s/hpa.yaml](#k8shpayaml)
  - [CI/CD Pipelines](#cicd-pipelines)
    - [GitHub Actions](#github-actions)
- [.github/workflows/deploy.yml](#githubworkflowsdeployyml)
    - [Jenkins Pipeline](#jenkins-pipeline)
  - [Deployment Strategies](#deployment-strategies)
    - [Rolling Update](#rolling-update)
    - [Blue-Green Deployment](#blue-green-deployment)
- [blue-deployment.yaml (current)](#blue-deploymentyaml-current)
- [green-deployment.yaml (new)](#green-deploymentyaml-new)
- [service.yaml](#serviceyaml)
    - [Canary Deployment](#canary-deployment)
- [Using Argo Rollouts for canary](#using-argo-rollouts-for-canary)
  - [Summary](#summary)
  - [Container Security Hardening](#container-security-hardening)
    - [Hardened Dockerfile](#hardened-dockerfile)
    - [Image Signing and Provenance](#image-signing-and-provenance)
- [Sign image with Cosign (keyless, OIDC-based)](#sign-image-with-cosign-keyless-oidc-based)
- [Generate and attach SBOM (CycloneDX format)](#generate-and-attach-sbom-cyclonedx-format)
- [Attach SLSA provenance attestation](#attach-slsa-provenance-attestation)
- [Verify signature before deployment](#verify-signature-before-deployment)
    - [Vulnerability Scanning](#vulnerability-scanning)
- [Scan for vulnerabilities (zero critical/high required)](#scan-for-vulnerabilities-zero-criticalhigh-required)
- [CIS Docker Benchmark audit](#cis-docker-benchmark-audit)
  - [MCP Marketplace Distribution](#mcp-marketplace-distribution)
    - [Registry Publishing](#registry-publishing)
    - [server.json Metadata](#serverjson-metadata)
- [Operational Runbooks](#operational-runbooks)
  - [Introduction](#introduction)
  - [Troubleshooting](#troubleshooting)
    - [Service Not Responding](#service-not-responding)
- [1. Check pod status](#1-check-pod-status)
- [2. Check pod logs](#2-check-pod-logs)
- [3. Check events](#3-check-events)
- [4. Check resource usage](#4-check-resource-usage)
- [5. Describe problematic pod](#5-describe-problematic-pod)
- [scripts/diagnose_service.sh](#scriptsdiagnoseservicesh)
    - [High Error Rate](#high-error-rate)
- [1. Check error logs](#1-check-error-logs)
- [2. Query Prometheus for error rate](#2-query-prometheus-for-error-rate)
- [3. Check database connectivity](#3-check-database-connectivity)
- [4. Check external service health](#4-check-external-service-health)
- [scripts/analyze_errors.py](#scriptsanalyzeerrorspy)
    - [High Latency](#high-latency)
- [1. Check current latency metrics](#1-check-current-latency-metrics)
- [2. Check database query performance](#2-check-database-query-performance)
- [3. Check cache hit rate](#3-check-cache-hit-rate)
- [4. Profile application](#4-profile-application)
- [scripts/analyze_performance.py](#scriptsanalyzeperformancepy)
    - [Memory Leak](#memory-leak)
- [1. Monitor memory over time](#1-monitor-memory-over-time)
- [2. Get memory profile](#2-get-memory-profile)
- [3. Check for object leaks](#3-check-for-object-leaks)
- [scripts/profile_memory.py](#scriptsprofilememorypy)
  - [Incident Response](#incident-response)
    - [Incident Response Process](#incident-response-process)
    - [Severity Levels](#severity-levels)
    - [Incident Response Checklist](#incident-response-checklist)
- [Incident Response Checklist](#incident-response-checklist)
  - [Detection](#detection)
  - [Triage](#triage)
  - [Investigation](#investigation)
  - [Mitigation](#mitigation)
  - [Resolution](#resolution)
  - [Post-Mortem](#post-mortem)
    - [Rollback Procedure](#rollback-procedure)
- [scripts/rollback.sh](#scriptsrollbacksh)
- [Rollback](#rollback)
- [Wait for rollout](#wait-for-rollout)
- [Verify health](#verify-health)
- [Run smoke tests](#run-smoke-tests)
  - [Performance Tuning](#performance-tuning)
    - [Database Tuning](#database-tuning)
    - [Application Tuning](#application-tuning)
- [config/production.yaml](#configproductionyaml)
- [Use connection pooling](#use-connection-pooling)
    - [Resource Limits](#resource-limits)
- [k8s/deployment.yaml](#k8sdeploymentyaml)
  - [Routine Maintenance](#routine-maintenance)
    - [Daily Tasks](#daily-tasks)
- [scripts/daily_maintenance.sh](#scriptsdailymaintenancesh)
- [Check service health](#check-service-health)
- [Check resource usage](#check-resource-usage)
- [Check error logs](#check-error-logs)
- [Database health](#database-health)
    - [Weekly Tasks](#weekly-tasks)
- [scripts/weekly_maintenance.sh](#scriptsweeklymaintenancesh)
- [Vacuum database](#vacuum-database)
- [Update database statistics](#update-database-statistics)
- [Clear old logs](#clear-old-logs)
- [Review metrics](#review-metrics)
    - [Monthly Tasks](#monthly-tasks)
  - [Disaster Recovery](#disaster-recovery)
    - [Backup Procedures](#backup-procedures)
- [scripts/backup.sh](#scriptsbackupsh)
- [Database backup](#database-backup)
- [Configuration backup](#configuration-backup)
- [Upload to S3](#upload-to-s3)
    - [Restore Procedures](#restore-procedures)
- [scripts/restore.sh](#scriptsrestoresh)
- [Stop application](#stop-application)
- [Restore database](#restore-database)
- [Restart application](#restart-application)
  - [Summary](#summary)
- [Agentic Best Practices](#agentic-best-practices)
  - [Introduction](#introduction)
  - [Context Management](#context-management)
    - [Maintaining Conversation Context](#maintaining-conversation-context)
- [src/mcp_server/context.py](#srcmcpservercontextpy)
- [Global context manager](#global-context-manager)
    - [Using Context in Tools](#using-context-in-tools)
  - [User Elicitation Patterns](#user-elicitation-patterns)
    - [Progressive Information Gathering](#progressive-information-gathering)
    - [Confirmation Patterns](#confirmation-patterns)
  - [Resource Templates](#resource-templates)
    - [Structured Templates for Common Operations](#structured-templates-for-common-operations)
- [src/mcp_server/templates.py](#srcmcpservertemplatespy)
  - [Prompt Engineering for Tools](#prompt-engineering-for-tools)
    - [Tool Descriptions](#tool-descriptions)
    - [Guided Tool Usage](#guided-tool-usage)
  - [Agent Workflow Patterns](#agent-workflow-patterns)
    - [Multi-Step Workflows](#multi-step-workflows)
    - [Error Recovery](#error-recovery)
  - [Best Practices Summary](#best-practices-summary)
    - [Tool Design Principles](#tool-design-principles)
    - [Agent Interaction Guidelines](#agent-interaction-guidelines)
  - [Multi-Agent Coordination](#multi-agent-coordination)
    - [Agent Handoff Pattern](#agent-handoff-pattern)
    - [Consensus Pattern](#consensus-pattern)
    - [Collaborative Problem Solving](#collaborative-problem-solving)
  - [Summary](#summary)
- [Migration Guides](#migration-guides)
  - [Introduction](#introduction)
  - [Migration Scenarios Covered](#migration-scenarios-covered)
  - [1. Migrating from REST API to MCP](#1-migrating-from-rest-api-to-mcp)
    - [Drivers](#drivers)
    - [Preparation](#preparation)
    - [Phased Approach](#phased-approach)
    - [Validation & Rollback](#validation-rollback)
  - [2. Upgrading Between MCP Protocol Versions](#2-upgrading-between-mcp-protocol-versions)
    - [Drivers](#drivers)
    - [Preparation](#preparation)
    - [Strategy](#strategy)
    - [Validation & Rollback](#validation-rollback)
  - [3. Migrating Between Authentication Providers](#3-migrating-between-authentication-providers)
    - [Drivers](#drivers)
    - [Preparation](#preparation)
    - [Execution Phases](#execution-phases)
    - [Risk Mitigation](#risk-mitigation)
  - [4. Database Migration Patterns](#4-database-migration-patterns)
    - [Drivers](#drivers)
    - [Common Patterns](#common-patterns)
    - [Tooling](#tooling)
    - [Rollback](#rollback)
  - [5. Zero-Downtime Deployment Strategies](#5-zero-downtime-deployment-strategies)
    - [Objectives](#objectives)
    - [Core Approaches](#core-approaches)
    - [Key Considerations](#key-considerations)
    - [Rollback Plan](#rollback-plan)
  - [Summary](#summary)
- [Troubleshooting Guide](#troubleshooting-guide)
  - [Quick Links](#quick-links)
  - [Introduction](#introduction)
  - [Common Issues](#common-issues)
    - [Authentication Failures](#authentication-failures)
- [Check token expiration](#check-token-expiration)
- [Usage](#usage)
- [Test token signature with curl](#test-token-signature-with-curl)
- [Verify token manually](#verify-token-manually)
- [Test with proper header](#test-with-proper-header)
- [Common mistakes](#common-mistakes)
- [1. Check server logs for auth failures](#1-check-server-logs-for-auth-failures)
- [2. Verify auth service connectivity](#2-verify-auth-service-connectivity)
- [3. Test token refresh](#3-test-token-refresh)
- [4. Check token blacklist/revocation](#4-check-token-blacklistrevocation)
- [Check user permissions](#check-user-permissions)
- [Usage](#usage)
- [Check current IP](#check-current-ip)
- [Check if IP is whitelisted](#check-if-ip-is-whitelisted)
- [Add IP to whitelist](#add-ip-to-whitelist)
    - [Rate Limiting Problems](#rate-limiting-problems)
- [Check rate limit headers](#check-rate-limit-headers)
- [Output:](#output)
- [X-RateLimit-Limit: 100](#x-ratelimit-limit-100)
- [X-RateLimit-Remaining: 0](#x-ratelimit-remaining-0)
- [X-RateLimit-Reset: 1700500000](#x-ratelimit-reset-1700500000)
- [Retry-After: 58](#retry-after-58)
- [Calculate reset time](#calculate-reset-time)
- [rate_limit_check.py](#ratelimitcheckpy)
- [Usage](#usage)
- [1. Request rate limit increase](#1-request-rate-limit-increase)
- [2. Reset rate limit for user (emergency)](#2-reset-rate-limit-for-user-emergency)
- [3. Implement exponential backoff in client](#3-implement-exponential-backoff-in-client)
    - [Performance Degradation](#performance-degradation)
- [1. Check endpoint latency distribution](#1-check-endpoint-latency-distribution)
- [Output:](#output)
- [mcp_request_duration_seconds{quantile="0.5"} 0.125](#mcprequestdurationsecondsquantile05-0125)
- [mcp_request_duration_seconds{quantile="0.95"} 0.487](#mcprequestdurationsecondsquantile095-0487)
- [mcp_request_duration_seconds{quantile="0.99"} 1.234](#mcprequestdurationsecondsquantile099-1234)
- [2. Identify slow endpoints](#2-identify-slow-endpoints)
- [3. Check system resources](#3-check-system-resources)
- [Output:](#output)
- [NAME                          CPU(cores)   MEMORY(bytes)](#name-cpucores-memorybytes)
- [mcp-server-7d8f9c4b5-abc12    985m         2048Mi](#mcp-server-7d8f9c4b5-abc12-985m-2048mi)
- [mcp-server-7d8f9c4b5-def34    1200m        2304Mi  # ⚠️ High CPU](#mcp-server-7d8f9c4b5-def34-1200m-2304mi-high-cpu)
- [diagnose_slow_queries.py](#diagnoseslowqueriespy)
- [Usage](#usage)
- [profile_endpoint.py](#profileendpointpy)
- [Alternative: Use py-spy for live profiling](#alternative-use-py-spy-for-live-profiling)
- [pip install py-spy](#pip-install-py-spy)
- [sudo py-spy record -o profile.svg --pid $(pgrep -f "mcp-server")](#sudo-py-spy-record-o-profilesvg-pid-pgrep-f-mcp-server)
- [1. Add database indexes](#1-add-database-indexes)
- [2. Enable query caching](#2-enable-query-caching)
- [3. Scale horizontally](#3-scale-horizontally)
- [4. Enable connection pooling](#4-enable-connection-pooling)
- [Update config](#update-config)
    - [Memory Leaks](#memory-leaks)
- [1. Monitor memory growth over time](#1-monitor-memory-growth-over-time)
- [Watch for 5 minutes](#watch-for-5-minutes)
- [Analyze growth rate](#analyze-growth-rate)
- [memory_profiler.py](#memoryprofilerpy)
- [Alternative: tracemalloc for detailed analysis](#alternative-tracemalloc-for-detailed-analysis)
- [Usage](#usage)
- [1. Unclosed database connections](#1-unclosed-database-connections)
- [❌ Bad: Connection leak](#-bad-connection-leak)
- [✅ Good: Proper cleanup](#-good-proper-cleanup)
- [2. Growing cache without eviction](#2-growing-cache-without-eviction)
- [❌ Bad: Unbounded cache](#-bad-unbounded-cache)
- [✅ Good: LRU cache with size limit](#-good-lru-cache-with-size-limit)
- [3. Circular references](#3-circular-references)
- [❌ Bad: Circular reference preventing GC](#-bad-circular-reference-preventing-gc)
- [✅ Good: Use weak references](#-good-use-weak-references)
- [1. Restart pods with memory leak](#1-restart-pods-with-memory-leak)
- [2. Set memory limits to prevent OOM](#2-set-memory-limits-to-prevent-oom)
- [3. Enable memory profiling in production](#3-enable-memory-profiling-in-production)
- [4. Configure aggressive garbage collection](#4-configure-aggressive-garbage-collection)
    - [Database Connection Issues](#database-connection-issues)
- [1. Check connection pool status](#1-check-connection-pool-status)
- [Output:](#output)
- [total_connections | active | idle | idle_in_transaction](#totalconnections-active-idle-idleintransaction)
- [45 |     12 |   28 |                   5  ⚠️](#45-12-28-5-)
- [2. Find long-running transactions](#2-find-long-running-transactions)
- [3. Check for locks](#3-check-for-locks)
- [connection_leak_detector.py](#connectionleakdetectorpy)
- [Usage](#usage)
- [Periodically check for leaks](#periodically-check-for-leaks)
- [1. Kill idle transactions](#1-kill-idle-transactions)
- [2. Increase pool size temporarily](#2-increase-pool-size-temporarily)
- [3. Enable connection timeout](#3-enable-connection-timeout)
- [4. Monitor connection pool metrics](#4-monitor-connection-pool-metrics)
  - [Diagnostic Commands](#diagnostic-commands)
    - [System Health Check](#system-health-check)
- [health_check.sh - Comprehensive system health check](#healthchecksh-comprehensive-system-health-check)
- [1. Service availability](#1-service-availability)
- [2. Pod status](#2-pod-status)
- [3. Resource usage](#3-resource-usage)
- [4. Recent errors](#4-recent-errors)
- [5. Database connectivity](#5-database-connectivity)
- [6. Redis connectivity](#6-redis-connectivity)
- [7. Active alerts](#7-active-alerts)
- [8. Request rate](#8-request-rate)
- [9. Error rate](#9-error-rate)
    - [Network Diagnostics](#network-diagnostics)
- [network_diagnostics.sh](#networkdiagnosticssh)
- [1. DNS resolution](#1-dns-resolution)
- [2. Port connectivity](#2-port-connectivity)
- [3. TLS certificate check](#3-tls-certificate-check)
- [4. Latency test](#4-latency-test)
- [5. Trace route](#5-trace-route)
    - [Dependency Health Check](#dependency-health-check)
- [check_dependencies.sh](#checkdependenciessh)
- [PostgreSQL](#postgresql)
- [Redis](#redis)
- [Message Queue (RabbitMQ)](#message-queue-rabbitmq)
- [Object Storage (S3)](#object-storage-s3)
  - [Log Analysis Patterns](#log-analysis-patterns)
    - [Structured Log Queries](#structured-log-queries)
- [1. Authentication failures by user](#1-authentication-failures-by-user)
- [2. Slow requests (>1s)](#2-slow-requests-1s)
- [3. Error rate by endpoint](#3-error-rate-by-endpoint)
- [4. Database query errors](#4-database-query-errors)
- [5. Rate limit violations](#5-rate-limit-violations)
    - [Log Correlation](#log-correlation)
- [log_correlator.py](#logcorrelatorpy)
- [Usage](#usage)
    - [Anomaly Detection](#anomaly-detection)
- [anomaly_detection.py](#anomalydetectionpy)
- [Usage](#usage)
  - [Performance Profiling](#performance-profiling)
    - [CPU Profiling](#cpu-profiling)
- [1. Install profiling tools](#1-install-profiling-tools)
- [2. Profile running process](#2-profile-running-process)
- [3. Top functions (live view)](#3-top-functions-live-view)
- [4. Flame graph generation](#4-flame-graph-generation)
- [1. Generate flame graph](#1-generate-flame-graph)
- [2. Open in browser](#2-open-in-browser)
- [3. Identify hot paths (widest sections)](#3-identify-hot-paths-widest-sections)
- [4. Click to zoom into specific functions](#4-click-to-zoom-into-specific-functions)
- [5. Note cumulative time percentages](#5-note-cumulative-time-percentages)
- [6. For interactive analysis, use speedscope format](#6-for-interactive-analysis-use-speedscope-format)
- [Upload to https://www.speedscope.app/](#upload-to-httpswwwspeedscopeapp)
    - [Application Profiling](#application-profiling)
- [profiler.py](#profilerpy)
- [Add to FastAPI app](#add-to-fastapi-app)
  - [Memory Profiling](#memory-profiling)
    - [Heap Analysis](#heap-analysis)
- [memory_analysis.py](#memoryanalysispy)
- [Usage](#usage)
    - [Memory Leak Detection](#memory-leak-detection)
- [leak_detector.py](#leakdetectorpy)
- [Usage](#usage)
  - [Summary](#summary)
- [Cost Optimization Guide](#cost-optimization-guide)
  - [Quick Links](#quick-links)
  - [Introduction](#introduction)
  - [Cost Visibility and Tracking](#cost-visibility-and-tracking)
    - [Cost Monitoring Dashboard](#cost-monitoring-dashboard)
- [cost_tracking/cost_monitor.py](#costtrackingcostmonitorpy)
- [Usage](#usage)
    - [Cost Allocation Tags](#cost-allocation-tags)
- [terraform/tags.tf](#terraformtagstf)
- [Apply tags to all resources](#apply-tags-to-all-resources)
  - [Resource Sizing Recommendations](#resource-sizing-recommendations)
    - [Compute Resources](#compute-resources)
- [cost_optimization/rightsizing.py](#costoptimizationrightsizingpy)
- [Usage](#usage)
    - [Database Resources](#database-resources)
- [cost_optimization/connection_pooling.py](#costoptimizationconnectionpoolingpy)
- [Compare with and without pooling](#compare-with-and-without-pooling)
    - [Cache Resources](#cache-resources)
- [cost_optimization/cache_sizing.py](#costoptimizationcachesizingpy)
- [Usage](#usage)
  - [Caching Strategies for Cost Reduction](#caching-strategies-for-cost-reduction)
    - [Intelligent Cache Warming](#intelligent-cache-warming)
- [cost_optimization/cache_warming.py](#costoptimizationcachewarmingpy)
- [Cost Impact:](#cost-impact)
- [- Reduces cold cache miss rate from 22% to 5%](#-reduces-cold-cache-miss-rate-from-22-to-5)
- [- Saves ~$145/month in database query costs](#-saves-145month-in-database-query-costs)
- [- Improves P99 latency by 40%](#-improves-p99-latency-by-40)
    - [Cache Invalidation Strategies](#cache-invalidation-strategies)
- [cost_optimization/cache_invalidation.py](#costoptimizationcacheinvalidationpy)
- [Cost Impact by Strategy:](#cost-impact-by-strategy)
- [TTL: Lowest complexity, 15% stale data, $30/month cache cost](#ttl-lowest-complexity-15-stale-data-30month-cache-cost)
- [Event: Highest accuracy, 1% stale data, $45/month (more invalidations)](#event-highest-accuracy-1-stale-data-45month-more-invalidations)
- [Hybrid: Balanced, 3% stale data, $32/month (recommended)](#hybrid-balanced-3-stale-data-32month-recommended)
  - [Database Query Optimization](#database-query-optimization)
    - [Query Cost Analysis](#query-cost-analysis)
- [cost_optimization/query_cost_analysis.py](#costoptimizationquerycostanalysispy)
- [Usage](#usage)
    - [Index Optimization](#index-optimization)
  - [API Call Batching Patterns](#api-call-batching-patterns)
    - [Request Batching](#request-batching)
- [cost_optimization/request_batching.py](#costoptimizationrequestbatchingpy)
- [Cost Savings Example:](#cost-savings-example)
- [Without batching: 10,000 requests × $0.001 = $10.00](#without-batching-10000-requests-0001-1000)
- [With batching (100 per batch): 100 API calls × $0.001 = $0.10](#with-batching-100-per-batch-100-api-calls-0001-010)
- [Savings: $9.90 (99% reduction)](#savings-990-99-reduction)
- [Usage](#usage)
- [Queue multiple requests](#queue-multiple-requests)
- [All requests batched into ~10 API calls](#all-requests-batched-into-10-api-calls)
    - [Database Query Batching](#database-query-batching)
- [cost_optimization/query_batching.py](#costoptimizationquerybatchingpy)
- [Performance comparison for 100 users:](#performance-comparison-for-100-users)
- [Inefficient: 100 queries × 5ms = 500ms](#inefficient-100-queries-5ms-500ms)
- [Efficient: 1 query × 8ms = 8ms](#efficient-1-query-8ms-8ms)
- [Improvement: 62x faster](#improvement-62x-faster)
- [Cost comparison:](#cost-comparison)
- [Inefficient: 100 queries × $0.0001 = $0.01](#inefficient-100-queries-00001-001)
- [Efficient: 1 query × $0.0001 = $0.0001](#efficient-1-query-00001-00001)
- [Savings: 99% per operation](#savings-99-per-operation)
  - [Cold Start Optimization](#cold-start-optimization)
    - [Lambda/Serverless Optimization](#lambdaserverless-optimization)
- [cost_optimization/cold_start.py](#costoptimizationcoldstartpy)
- [Cold Start Cost Analysis:](#cold-start-cost-analysis)
- [Cold start: 1200ms initialization + 150ms execution = 1350ms](#cold-start-1200ms-initialization-150ms-execution-1350ms)
- [Warm start: 150ms execution](#warm-start-150ms-execution)
- [Without optimization:](#without-optimization)
- [- Cold starts: 40% of invocations](#-cold-starts-40-of-invocations)
- [- Avg latency: (0.4 × 1350) + (0.6 × 150) = 630ms](#-avg-latency-04-1350-06-150-630ms)
- [- Cost: Higher due to longer execution time](#-cost-higher-due-to-longer-execution-time)
- [With optimization + warming:](#with-optimization-warming)
- [- Cold starts: 5% of invocations](#-cold-starts-5-of-invocations)
- [- Avg latency: (0.05 × 800) + (0.95 × 150) = 183ms](#-avg-latency-005-800-095-150-183ms)
- [- Cost savings: 25% reduction in compute costs](#-cost-savings-25-reduction-in-compute-costs)
    - [Provisioned Concurrency Strategy](#provisioned-concurrency-strategy)
- [serverless.yml - Cost-optimized provisioned concurrency](#serverlessyml-cost-optimized-provisioned-concurrency)
- [Cost Analysis:](#cost-analysis)
- [Always-on (50 concurrent): $1,200/month](#always-on-50-concurrent-1200month)
- [On-demand only: $400/month (high cold start rate)](#on-demand-only-400month-high-cold-start-rate)
- [Time-based provisioning: $650/month (balanced)](#time-based-provisioning-650month-balanced)
- [Savings vs always-on: $550/month (46%)](#savings-vs-always-on-550month-46)
  - [Auto-Scaling Policies](#auto-scaling-policies)
    - [Cost-Optimized Scaling](#cost-optimized-scaling)
- [cost_optimization/autoscaling.py](#costoptimizationautoscalingpy)
- [Usage](#usage)
    - [Predictive Scaling](#predictive-scaling)
- [cost_optimization/predictive_scaling.py](#costoptimizationpredictivescalingpy)
- [Cost Impact:](#cost-impact)
- [Reactive scaling: Scale after load increases (lag time = 2-3 minutes)](#reactive-scaling-scale-after-load-increases-lag-time-2-3-minutes)
- [- Result: Brief performance degradation](#-result-brief-performance-degradation)
- [- Over-provisioning to compensate: +30% cost](#-over-provisioning-to-compensate-30-cost)
- [Predictive scaling: Scale before load increases](#predictive-scaling-scale-before-load-increases)
- [- Result: Smooth performance](#-result-smooth-performance)
- [- Optimal provisioning: -20% cost vs reactive](#-optimal-provisioning-20-cost-vs-reactive)
- [- Annual savings: $1,800 for medium deployment](#-annual-savings-1800-for-medium-deployment)
  - [Storage Optimization](#storage-optimization)
    - [S3 Storage Classes](#s3-storage-classes)
    - [Database Storage Optimization](#database-storage-optimization)
  - [Network Cost Optimization](#network-cost-optimization)
    - [Data Transfer Costs](#data-transfer-costs)
- [cost_optimization/network_optimization.py](#costoptimizationnetworkoptimizationpy)
- [Total network optimization savings: $99/month (52% reduction)](#total-network-optimization-savings-99month-52-reduction)
  - [Summary](#summary)
    - [Key Savings Opportunities](#key-savings-opportunities)
    - [Cost Optimization Checklist](#cost-optimization-checklist)
- [Metrics and KPIs](#metrics-and-kpis)
  - [Quick Links](#quick-links)
  - [Introduction](#introduction)
  - [Service Level Objectives (SLOs)](#service-level-objectives-slos)
    - [Availability SLO](#availability-slo)
- [Availability percentage](#availability-percentage)
- [Error budget remaining (monthly)](#error-budget-remaining-monthly)
- [availability_calculator.py](#availabilitycalculatorpy)
- [Example: 30-day period](#example-30-day-period)
- [prometheus/rules/slo_availability.yaml](#prometheusrulessloavailabilityyaml)
    - [Latency SLO](#latency-slo)
- [P99 latency](#p99-latency)
- [Latency SLI (requests meeting SLO)](#latency-sli-requests-meeting-slo)
- [prometheus/rules/slo_latency.yaml](#prometheusrulesslolatencyyaml)
    - [Error Rate SLO](#error-rate-slo)
- [Error rate](#error-rate)
- [Success rate](#success-rate)
- [prometheus/rules/slo_errors.yaml](#prometheusrulessloerrorsyaml)
    - [Composite SLO Dashboard](#composite-slo-dashboard)
  - [Business Metrics](#business-metrics)
    - [Tools Executed Per Day](#tools-executed-per-day)
- [Daily tool executions](#daily-tool-executions)
- [By tool type](#by-tool-type)
- [Growth rate (week-over-week)](#growth-rate-week-over-week)
- [metrics/business_metrics.py](#metricsbusinessmetricspy)
- [Daily report](#daily-report)
- [Usage](#usage)
    - [Active Users](#active-users)
- [Daily Active Users (DAU)](#daily-active-users-dau)
- [Weekly Active Users (WAU)](#weekly-active-users-wau)
- [Monthly Active Users (MAU)](#monthly-active-users-mau)
- [Engagement ratio](#engagement-ratio)
- [cohort_analysis.py](#cohortanalysispy)
- [Usage](#usage)
    - [API Call Volume](#api-call-volume)
- [Requests per second](#requests-per-second)
- [Requests per day](#requests-per-day)
- [By endpoint](#by-endpoint)
- [Growth trend (7-day moving average)](#growth-trend-7-day-moving-average)
- [traffic_analysis.py](#trafficanalysispy)
- [Usage](#usage)
  - [Operational Metrics](#operational-metrics)
    - [Deployment Frequency](#deployment-frequency)
- [Deployments per day](#deployments-per-day)
- [Time between deployments](#time-between-deployments)
- [Deployment success rate](#deployment-success-rate)
- [deployment_metrics.py](#deploymentmetricspy)
- [Deployment report](#deployment-report)
- [Usage](#usage)
    - [MTTR (Mean Time To Recovery)](#mttr-mean-time-to-recovery)
- [MTTR (hours)](#mttr-hours)
- [MTTR by severity](#mttr-by-severity)
- [incident_metrics.py](#incidentmetricspy)
- [MTTR analysis](#mttr-analysis)
- [Usage](#usage)
    - [Change Failure Rate](#change-failure-rate)
- [Change failure rate](#change-failure-rate)
- [change_failure_tracking.py](#changefailuretrackingpy)
- [Usage](#usage)
  - [Metrics Dashboard](#metrics-dashboard)
    - [Executive Dashboard](#executive-dashboard)
  - [Summary](#summary)
- [Performance Benchmarks](#performance-benchmarks)
  - [Quick Links](#quick-links)
  - [Introduction](#introduction)
  - [Baseline Performance Metrics](#baseline-performance-metrics)
    - [Standard Configuration](#standard-configuration)
    - [Benchmark Script](#benchmark-script)
- [benchmarks/baseline_benchmark.py](#benchmarksbaselinebenchmarkpy)
- [Usage](#usage)
  - [Configuration Comparisons](#configuration-comparisons)
    - [Worker Process Count](#worker-process-count)
    - [Database Connection Pool Size](#database-connection-pool-size)
    - [Cache Configuration](#cache-configuration)
    - [Serialization Format](#serialization-format)
  - [Load Testing Results](#load-testing-results)
    - [Sustained Load Test](#sustained-load-test)
    - [Spike Load Test](#spike-load-test)
- [benchmarks/spike_test_results.py](#benchmarksspiketestresultspy)
    - [Endurance Test](#endurance-test)
  - [Scaling Characteristics](#scaling-characteristics)
    - [Horizontal Scaling](#horizontal-scaling)
- [benchmarks/scaling_analysis.py](#benchmarksscalinganalysispy)
- [Results show excellent horizontal scaling up to 8 instances](#results-show-excellent-horizontal-scaling-up-to-8-instances)
- [Diminishing returns beyond 8 instances due to:](#diminishing-returns-beyond-8-instances-due-to)
- [- Shared database bottleneck](#-shared-database-bottleneck)
- [- Network overhead](#-network-overhead)
- [- Load balancer saturation](#-load-balancer-saturation)
    - [Vertical Scaling](#vertical-scaling)
    - [Auto-Scaling Configuration](#auto-scaling-configuration)
- [k8s/hpa.yaml](#k8shpayaml)
- [benchmarks/autoscaling_test.py](#benchmarksautoscalingtestpy)
  - [Tool-Specific Performance](#tool-specific-performance)
    - [Simple Tool Execution](#simple-tool-execution)
    - [Complex Tool Execution](#complex-tool-execution)
    - [External API Tool](#external-api-tool)
    - [Batch Processing Tool](#batch-processing-tool)
  - [Hardware Recommendations](#hardware-recommendations)
    - [Production Deployment Tiers](#production-deployment-tiers)
    - [Storage Recommendations](#storage-recommendations)
    - [Network Recommendations](#network-recommendations)
  - [Optimization Strategies](#optimization-strategies)
    - [Database Optimization](#database-optimization)
- [Before: N+1 query problem (slow)](#before-n1-query-problem-slow)
- [After: Single query with join (fast)](#after-single-query-with-join-fast)
- [Performance improvement: 45x faster](#performance-improvement-45x-faster)
    - [Caching Optimization](#caching-optimization)
- [benchmarks/cache_strategy.py](#benchmarkscachestrategypy)
- [Performance improvement:](#performance-improvement)
- [- L1 hit: 1-2 μs (500,000 ops/sec)](#-l1-hit-1-2-s-500000-opssec)
- [- L2 hit: 200-500 μs (2,000-5,000 ops/sec)](#-l2-hit-200-500-s-2000-5000-opssec)
- [- Database: 5-20 ms (50-200 ops/sec)](#-database-5-20-ms-50-200-opssec)
    - [Connection Pool Tuning](#connection-pool-tuning)
- [database.py](#databasepy)
- [Total pool size = workers × (pool_size + max_overflow)](#total-pool-size-workers-poolsize-maxoverflow)
- [Example: 4 workers × (25 + 10) = 140 max connections](#example-4-workers-25-10-140-max-connections)
  - [Monitoring and Profiling](#monitoring-and-profiling)
    - [Performance Monitoring](#performance-monitoring)
- [prometheus/performance_metrics.yaml](#prometheusperformancemetricsyaml)
    - [Profiling Tools](#profiling-tools)
- [Profile production workload](#profile-production-workload)
- [Live top view](#live-top-view)
- [benchmarks/memory_profile.py](#benchmarksmemoryprofilepy)
  - [Summary](#summary)
- [MCP Protocol Version Compatibility](#mcp-protocol-version-compatibility)
  - [Introduction](#introduction)
  - [Supported Protocol Versions](#supported-protocol-versions)
    - [Current Support Matrix](#current-support-matrix)
    - [Governance](#governance)
  - [Protocol Version Feature Matrix](#protocol-version-feature-matrix)
    - [Core Capabilities by Version](#core-capabilities-by-version)
    - [Authorization & Security by Version](#authorization-security-by-version)
    - [Implementation / Metadata by Version](#implementation-metadata-by-version)
  - [Version-Specific Details](#version-specific-details)
    - [2025-11-25 (Current)](#2025-11-25-current)
    - [2025-06-18](#2025-06-18)
    - [2025-03-26](#2025-03-26)
    - [2024-11-05 (Initial Release)](#2024-11-05-initial-release)
  - [Version Negotiation](#version-negotiation)
    - [How MCP Version Negotiation Works](#how-mcp-version-negotiation-works)
    - [MCP-Protocol-Version HTTP Header](#mcp-protocol-version-http-header)
    - [Backwards Compatibility](#backwards-compatibility)
  - [Session Management](#session-management)
    - [Mcp-Session-Id](#mcp-session-id)
    - [Resumability](#resumability)
  - [Capability Negotiation Reference](#capability-negotiation-reference)
    - [Client Capabilities (2025-11-25)](#client-capabilities-2025-11-25)
    - [Server Capabilities (2025-11-25)](#server-capabilities-2025-11-25)
  - [Migration Guidance](#migration-guidance)
    - [Upgrading from 2025-06-18 to 2025-11-25](#upgrading-from-2025-06-18-to-2025-11-25)
    - [Upgrading from 2025-03-26 to 2025-11-25](#upgrading-from-2025-03-26-to-2025-11-25)
    - [Upgrading from 2024-11-05 to 2025-11-25](#upgrading-from-2024-11-05-to-2025-11-25)
  - [FastMCP v3 Framework Mapping](#fastmcp-v3-framework-mapping)
    - [SDK Version to Protocol Version](#sdk-version-to-protocol-version)
    - [Automatic Protocol Handling](#automatic-protocol-handling)
- [FastMCP automatically handles:](#fastmcp-automatically-handles)
- [- Protocol version negotiation during initialize handshake](#-protocol-version-negotiation-during-initialize-handshake)
- [- MCP-Protocol-Version header on all HTTP responses](#-mcp-protocol-version-header-on-all-http-responses)
- [- Mcp-Session-Id generation and validation](#-mcp-session-id-generation-and-validation)
- [- Capability declaration based on registered components](#-capability-declaration-based-on-registered-components)
- [- Streamable HTTP transport with SSE upgrade](#-streamable-http-transport-with-sse-upgrade)
- [- Pagination via list_page_size parameter](#-pagination-via-listpagesize-parameter)
- [Capabilities are auto-declared based on what you register](#capabilities-are-auto-declared-based-on-what-you-register)
    - [Transport Selection](#transport-selection)
    - [Backward Compatibility in FastMCP](#backward-compatibility-in-fastmcp)
  - [Security Considerations](#security-considerations)
    - [Origin Validation (Streamable HTTP)](#origin-validation-streamable-http)
    - [Session Security](#session-security)
    - [Token Audience Binding](#token-audience-binding)
  - [Summary](#summary)
- [Quick Reference Guide](#quick-reference-guide)
  - [Overview](#overview)
  - [EARS Requirements Patterns Quick Reference](#ears-requirements-patterns-quick-reference)
    - [When to Use Each EARS Pattern](#when-to-use-each-ears-pattern)
    - [EARS Syntax Templates](#ears-syntax-templates)
    - [Quick Examples](#quick-examples)
  - [MCP Primitives Decision Tree](#mcp-primitives-decision-tree)
    - [When to Use Tools vs Prompts vs Resources](#when-to-use-tools-vs-prompts-vs-resources)
  - [Common Patterns Cheat Sheet](#common-patterns-cheat-sheet)
    - [Tool Naming Standards](#tool-naming-standards)
- [✅ Correct verb-noun pattern](#-correct-verb-noun-pattern)
- [❌ Incorrect](#-incorrect)
    - [Prompt Naming Standards](#prompt-naming-standards)
- [✅ Descriptive workflow names](#-descriptive-workflow-names)
- [❌ Incorrect](#-incorrect)
    - [Resource URI Patterns](#resource-uri-patterns)
- [✅ Well-structured URIs](#-well-structured-uris)
- [❌ Incorrect](#-incorrect)
  - [Response Format Standards](#response-format-standards)
    - [Success Response](#success-response)
    - [Error Response](#error-response)
  - [Error Code Categories](#error-code-categories)
  - [Security Checklist](#security-checklist)
    - [Before Deploying Any MCP Server](#before-deploying-any-mcp-server)
  - [Testing Coverage Targets](#testing-coverage-targets)
  - [Sampling Temperature Guide](#sampling-temperature-guide)
- [Deterministic (structured data extraction)](#deterministic-structured-data-extraction)
- [Focused (technical summaries, documentation)](#focused-technical-summaries-documentation)
- [Balanced (general content generation)](#balanced-general-content-generation)
- [Creative (brainstorming, storytelling)](#creative-brainstorming-storytelling)
  - [Common Anti-Patterns to Avoid](#common-anti-patterns-to-avoid)
    - [❌ Don't: Implement Tools Without Versioning](#-dont-implement-tools-without-versioning)
- [Bad: No version, breaking changes affect all users](#bad-no-version-breaking-changes-affect-all-users)
    - [✅ Do: Version Breaking Changes](#-do-version-breaking-changes)
- [Good: v1 deprecated, v2 with new required parameter](#good-v1-deprecated-v2-with-new-required-parameter)
    - [❌ Don't: Return Unstructured Errors](#-dont-return-unstructured-errors)
- [Bad: No structure, no actionable information](#bad-no-structure-no-actionable-information)
    - [✅ Do: Return Structured Errors](#-do-return-structured-errors)
- [Good: Structured with code, message, and action](#good-structured-with-code-message-and-action)
    - [❌ Don't: Expose Raw Database Errors](#-dont-expose-raw-database-errors)
- [Bad: Leaks implementation details](#bad-leaks-implementation-details)
    - [✅ Do: Wrap and Sanitize Errors](#-do-wrap-and-sanitize-errors)
- [Good: Generic user-facing error, log details internally](#good-generic-user-facing-error-log-details-internally)
  - [Performance Quick Wins](#performance-quick-wins)
    - [Caching Strategy](#caching-strategy)
- [TTL-based caching for relatively static data](#ttl-based-caching-for-relatively-static-data)
    - [Connection Pooling](#connection-pooling)
- [Reuse database connections](#reuse-database-connections)
    - [Pagination](#pagination)
- [Always paginate large datasets](#always-paginate-large-datasets)
  - [Observability Essentials](#observability-essentials)
    - [Structured Logging](#structured-logging)
    - [Key Metrics to Track](#key-metrics-to-track)
    - [Distributed Tracing](#distributed-tracing)
  - [Integration Patterns Summary](#integration-patterns-summary)
    - [REST API Integration](#rest-api-integration)
- [With retry and circuit breaker](#with-retry-and-circuit-breaker)
    - [Database Integration](#database-integration)
- [Using connection pool](#using-connection-pool)
  - [Deployment Checklist](#deployment-checklist)
    - [Pre-Production](#pre-production)
    - [Production Deployment](#production-deployment)
  - [Useful Commands](#useful-commands)
    - [Build Documentation](#build-documentation)
    - [Local Testing](#local-testing)
- [Run tests](#run-tests)
- [Run with coverage](#run-with-coverage)
- [Security scan](#security-scan)
    - [Docker Operations](#docker-operations)
- [Build](#build)
- [Run locally](#run-locally)
- [Check logs](#check-logs)
  - [Reference Links](#reference-links)

<div class="page-break"></div>
